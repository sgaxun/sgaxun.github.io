<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://sgaxun.github.io</id>
    <title>sgaxun&apos;s blog</title>
    <updated>2023-03-08T17:15:18.583Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://sgaxun.github.io"/>
    <link rel="self" href="https://sgaxun.github.io/atom.xml"/>
    <subtitle>Life couldnâ€™t be any more fantastic ï¼ŒItâ€™s perfect</subtitle>
    <logo>https://sgaxun.github.io/images/avatar.png</logo>
    <icon>https://sgaxun.github.io/favicon.ico</icon>
    <rights>All rights reserved 2023, sgaxun&apos;s blog</rights>
    <entry>
        <title type="html"><![CDATA[ä½¿ç”¨Touch IDå’ŒApple Watchå®ç°ç»ˆç«¯ä¸‹çš„sudoæˆæƒ]]></title>
        <id>https://sgaxun.github.io/post/sudo-touchId-watch/</id>
        <link href="https://sgaxun.github.io/post/sudo-touchId-watch/">
        </link>
        <updated>2021-12-14T16:42:31.000Z</updated>
        <summary type="html"><![CDATA[<blockquote>
<p>æ— æ„é—´è§åˆ°ä¸€ç¯‡æ–‡ç« ä»‹ç»<a href="https://1991421.cn/2020/12/10/74e2afe6/">ç»ˆç«¯ä¸‹åˆ©ç”¨Touch IDï¼ŒApple Watchå®ç°sudoæˆæƒ</a>ï¼Œæ„Ÿè§‰å¾ˆå¥½ç”¨ï¼Œç”¨äº†å¥½ä¹…,æœ€è¿‘æ›´æ¢äº†AppleèŠ¯ç‰‡çš„macåå‘ç°ä½¿ç”¨watchçš„æ–¹æ³•å¤±æ•ˆäº†ï¼Œè®°å½•ä¸€ä¸‹å®‰è£…ä»¥åŠè§£å†³åŠæ³•ã€‚</p>
</blockquote>
]]></summary>
        <content type="html"><![CDATA[<blockquote>
<p>æ— æ„é—´è§åˆ°ä¸€ç¯‡æ–‡ç« ä»‹ç»<a href="https://1991421.cn/2020/12/10/74e2afe6/">ç»ˆç«¯ä¸‹åˆ©ç”¨Touch IDï¼ŒApple Watchå®ç°sudoæˆæƒ</a>ï¼Œæ„Ÿè§‰å¾ˆå¥½ç”¨ï¼Œç”¨äº†å¥½ä¹…,æœ€è¿‘æ›´æ¢äº†AppleèŠ¯ç‰‡çš„macåå‘ç°ä½¿ç”¨watchçš„æ–¹æ³•å¤±æ•ˆäº†ï¼Œè®°å½•ä¸€ä¸‹å®‰è£…ä»¥åŠè§£å†³åŠæ³•ã€‚</p>
</blockquote>
<!-- more -->
<h3 id="ä¸‹è½½å®‰è£…">ä¸‹è½½å®‰è£…</h3>
<p>ä¸‹è½½ä¸¤ä¸ªä»“åº“ï¼Œåˆ†åˆ«æ˜¯<a href="https://github.com/Reflejo/pam-touchID">pam-touchID</a>å’Œ<a href="https://github.com/biscuitehh/pam-watchid">pam-watchid</a></p>
<pre><code class="language-shell">git clone https://github.com/Reflejo/pam-touchID
git clone https://github.com/biscuitehh/pam-watchid
# åˆ†åˆ«è¿›å…¥ä¸¤ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•æ‰§è¡Œå®‰è£…
sudo make install
</code></pre>
<h3 id="appleèŠ¯ç‰‡pam-watchidé¡¹ç›®é—®é¢˜ä¿®å¤">AppleèŠ¯ç‰‡pam-watchidé¡¹ç›®é—®é¢˜ä¿®å¤</h3>
<p>å¦‚æœä½ æ˜¯AppleèŠ¯ç‰‡çš„Mac,watché¡¹ç›®æ— æ³•ä½¿ç”¨ï¼ŒæŠ¥é”™:<em>unable to initialize PAM: No such file or directory</em>ã€‚éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶é‡æ–°å®‰è£…</p>
<p>é¦–å…ˆåœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ‰“å°swiftç‰ˆæœ¬</p>
<pre><code class="language-shell">echo $(swift -version)
# æ‰“å°ç»“æœ
Apple Swift version 5.5.2 (swiftlang-1300.0.47.5 clang-1300.0.29.30) Target: arm64-apple-darwin21.2.0
</code></pre>
<p>å¤åˆ¶æ‰“å°ç»“æœä¸­Targetåè¾¹çš„å†…å®¹ï¼Œç¼–è¾‘pam-watchidé¡¹ç›®ä¸­Makefileæ–‡ä»¶,æ›¿æ¢æ–‡ä»¶ä¸­TARGET=åè¾¹çš„å†…å®¹</p>
<pre><code class="language-shell">TARGET = arm64-apple-darwin21.2.0
</code></pre>
<p>é‡æ–°æ‰§è¡Œå®‰è£…</p>
<pre><code class="language-shell">sudo make install
</code></pre>
<h3 id="ç¼–è¾‘sudoé…ç½®å¼€å¯æˆæƒ">ç¼–è¾‘sudoé…ç½®ï¼Œå¼€å¯æˆæƒ</h3>
<pre><code class="language-shell">sudo vi /etc/pam.d/sudo
</code></pre>
<p>åœ¨æ–‡ä»¶æœ€ä¸Šè¾¹å¢åŠ ä»¥ä¸‹å†…å®¹</p>
<pre><code class="language-shell">auth sufficient pam_watchid.so &quot;reason=execute a 	command as root&quot;
auth sufficient pam_touchid.so &quot;reason=execute a 	command as root&quot;
</code></pre>
<p>æ–‡ä»¶ä¿å­˜åå³æ—¶ç”Ÿæ•ˆ</p>
<h3 id="æˆæƒé¡ºåº">æˆæƒé¡ºåº</h3>
<p>é…ç½®æ–‡ä»¶ä¸­é¡ºåºå°±æ˜¯æˆæƒä½¿ç”¨çš„ä¼˜å…ˆé¡ºåº,åŸåšä¸»çš„ä½¿ç”¨ä¹ æƒ¯æ˜¯touchidä¼˜å…ˆ,å› ä¸ºæˆ‘å¹³æ—¶ä½¿ç”¨å¤–æ¥é”®ç›˜ï¼Œæ‰€ä»¥touchidä¼˜å…ˆåè€Œä¸æ–¹ä¾¿ï¼Œå› æ­¤è°ƒæ•´äº†é¡ºåºï¼Œwatchidä¼˜å…ˆã€‚</p>
<p>ä½¿ç”¨æ•ˆæœå¦‚ä¸‹å›¾</p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20211216220108462.png" alt="image-20211216220108462" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JVM åŸç†æ¢ç©¶ä¹‹ä¸‰]]></title>
        <id>https://sgaxun.github.io/post/jvm-deepin-3/</id>
        <link href="https://sgaxun.github.io/post/jvm-deepin-3/">
        </link>
        <updated>2021-07-13T14:53:33.000Z</updated>
        <content type="html"><![CDATA[<h2 id="é«˜æ•ˆå¹¶å‘">é«˜æ•ˆå¹¶å‘</h2>
<h3 id="java-å†…å­˜æ¨¡å‹">Java å†…å­˜æ¨¡å‹</h3>
<p>JCP å®šä¹‰äº†ä¸€ç§ Java å†…å­˜æ¨¡å‹ï¼Œä»¥å‰æ˜¯åœ¨ JVM è§„èŒƒä¸­ï¼Œåæ¥ç‹¬ç«‹å‡ºæ¥æˆä¸º JSR-133ï¼ˆJava å†…å­˜æ¨¡å‹å’Œçº¿ç¨‹è§„èŒƒä¿®è®¢ï¼‰ã€‚</p>
<p>å†…å­˜æ¨¡å‹ï¼šåœ¨ç‰¹å®šçš„æ“ä½œåè®®ä¸‹ï¼Œå¯¹ç‰¹å®šçš„å†…å­˜æˆ–é«˜é€Ÿç¼“å­˜è¿›è¡Œè¯»å†™è®¿é—®çš„è¿‡ç¨‹æŠ½è±¡ã€‚</p>
<p>Java å†…å­˜æ¨¡å‹ä¸»è¦å…³æ³¨ JVM ä¸­æŠŠå˜é‡å€¼å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡å€¼è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118233151361.png" alt="image-20220118233151361" style="zoom:50%;" />
<p>æ‰€æœ‰å˜é‡ï¼ˆå…±äº«çš„ï¼‰éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜;å·¥ä½œå†…å­˜ä¸­ä¿å­˜è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚</p>
<p>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»ã€å†™ï¼‰éƒ½åº”è¯¥åœ¨å·¥ä½œå†…å­˜ä¸­å®Œæˆã€‚</p>
<p>ä¸åŒçº¿ç¨‹ä¹‹é—´ä¸èƒ½ç›¸äº’è®¿é—®å·¥ä½œå†…å­˜ï¼Œäº¤äº’æ•°æ®è¦é€šè¿‡ä¸»å†…å­˜ã€‚</p>
<h3 id="å†…å­˜é—´çš„äº¤äº’æ“ä½œ">å†…å­˜é—´çš„äº¤äº’æ“ä½œ</h3>
<p>Java å†…å­˜æ¨¡å‹è§„å®šäº†ä¸€äº›æ“ä½œæ¥å®ç°å†…å­˜é—´äº¤äº’ï¼ŒJVM ä¼šä¿è¯å®ƒä»¬æ˜¯åŸå­æ€§çš„ã€‚</p>
<ul>
<li>
<p>lockï¼šé”å®šï¼ŒæŠŠå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å ï¼Œä½œç”¨äºä¸»å†…å­˜å˜é‡ã€‚</p>
</li>
<li>
<p>unlockï¼šè§£é”ï¼ŒæŠŠé”å®šçš„å˜é‡é‡Šæ”¾ï¼Œåˆ«çš„çº¿ç¨‹æ‰èƒ½ä½¿ç”¨ï¼Œä½œç”¨äºä¸»å†…å­˜å˜é‡ã€‚</p>
</li>
<li>
<p>readï¼šè¯»å–ï¼ŒæŠŠå˜é‡å€¼ä»ä¸»å†…å­˜è¯»å–åˆ°å·¥ä½œå†…å­˜ã€‚</p>
</li>
<li>
<p>loadï¼šè½½å…¥ï¼ŒæŠŠ rea è¯»å–åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚</p>
</li>
<li>
<p>useï¼šä½¿ç”¨ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ã€‚</p>
</li>
<li>
<p>assignï¼šèµ‹å€¼ï¼ŒæŠŠä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜é‡Œé¢çš„å˜é‡ã€‚</p>
</li>
<li>
<p>storeï¼šå­˜å‚¨ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’åˆ°ä¸»å†…å­˜ä¸­ã€‚</p>
</li>
<li>
<p>writeï¼šå†™å…¥ï¼ŒæŠŠ store è¿›æ¥çš„æ•°æ®å­˜æ”¾å…¥ä¸»å†…å­˜å˜é‡ä¸­ã€‚</p>
</li>
</ul>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118234312212.png" alt="image-20220118234312212" style="zoom:50%;" />
<h4 id="å†…å­˜é—´äº¤äº’æ“ä½œè§„åˆ™">å†…å­˜é—´äº¤äº’æ“ä½œè§„åˆ™</h4>
<ul>
<li>ä¸å…è®¸ read å’Œ loadã€storeå’Œ write æ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œä»¥ä¸Šä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œä½†ä¸ä¿è¯è¿ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œread ä¸ load ä¹‹é—´ã€storeä¸ write ä¹‹é—´æ˜¯å¯æ’å…¥å…¶å®ƒæŒ‡ä»¤çš„ã€‚</li>
<li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘çš„ assign æ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠè¯¥å˜åŒ–åŒæ­¥å›ä¸»å†…å­˜ã€‚</li>
<li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› çš„ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½• assign æ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­åŒæ­¥å›ä¸»å†…å­˜ã€‚</li>
<li>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½ä»ä¸»å†…å­˜ä¸­ã€Œè¯ç”Ÿã€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½ use å’Œ store æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº† load å’Œ assign æ“ä½œã€‚</li>
<li>ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶æ‰§è¡Œ lock æ“ä½œï¼Œä½† lock æ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œ lock åï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„ unlock æ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚</li>
<li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œäº† lock æ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡ä¹‹å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ load æˆ– assig æ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚</li>
<li>å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰è¢« lock æ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œ unlock æ“ä½œï¼Œä¹Ÿä¸èƒ½ unlock ä¸€ä¸ªè¢«å…¶å®ƒçº¿ç¨‹é”å®šçš„å˜é‡ã€‚</li>
<li>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ï¼ˆæ‰§è¡Œ store å’Œ write æ“ä½œï¼‰ã€‚</li>
</ul>
<h3 id="å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§">å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§</h3>
<p>å¯è§æ€§ï¼šå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥çŸ¥é“ã€‚</p>
<h2 id="æ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·">æ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·</h2>
<h2 id="jvmè°ƒä¼˜">JVMè°ƒä¼˜</h2>
<h2 id="é¢è¯•">é¢è¯•</h2>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot é¡¹ç›®æ‰“åŒ… + Shell è„šæœ¬éƒ¨ç½²]]></title>
        <id>https://sgaxun.github.io/post/spring-boot-shell/</id>
        <link href="https://sgaxun.github.io/post/spring-boot-shell/">
        </link>
        <updated>2021-06-23T14:07:58.000Z</updated>
        <content type="html"><![CDATA[<p>åˆ†äº« Spring Boot æ‰“åŒ…å¹¶ç»“åˆ Shell è„šæœ¬å‘½ä»¤éƒ¨ç½²ï¼Œé‡ç‚¹åœ¨åˆ†äº«ä¸€ä¸ªshell ç¨‹åºå¯åŠ¨å·¥å…·ï¼Œæ–¹ä¾¿æ“ä½œã€‚</p>
<h2 id="profilesæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®">profilesæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®</h2>
<p>é€šå¸¸ä¸€å¥—ç¨‹åºåˆ†ä¸ºäº†å¾ˆå¤šä¸ªéƒ¨ç½²ç¯å¢ƒï¼šå¼€å‘ï¼Œæµ‹è¯•ï¼Œçº¿ä¸Šç­‰ï¼Œæˆ‘ä»¬è¦æƒ³å¯¹è¿™äº›ç¯å¢ƒåŒºåˆ†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>é€šè¿‡application.ymlä¸­ç¼–ç æŒ‡å®š profile.active=dev æ–¹å¼æŒ‡å®š</li>
<li>é€šè¿‡mvnä¸­profilesæ¥åŒºåˆ†ä¸åŒç¯å¢ƒå¯¹åº”çš„é…ç½®æ–‡ä»¶å¤¹ï¼Œäººå·¥å¯ä»¥æ‰‹åŠ¨åœ¨ideaå‹¾é€‰ç”Ÿæˆä¸åŒç¯å¢ƒçš„åŒ…</li>
</ul>
<p>ç¬¬ä¸€ç§æ–¹å¼è¿‡äºç®€å•æ— éœ€ä»‹ç»ï¼Œè¿™é‡Œä»‹ç»ç¬¬äºŒç§ï¼Œé¦–å…ˆåœ¨ mvn ä¸­é…ç½®å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-xml">&lt;profiles&gt;
	&lt;profile&gt;
		&lt;id&gt;node&lt;/id&gt;
		&lt;properties&gt;
			&lt;!--ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°å€¼--&gt;
			&lt;activeProfile&gt;node&lt;/activeProfile&gt;
			&lt;package-name&gt;${scripts_packageName}&lt;/package-name&gt;
			&lt;boot-main&gt;${scripts_bootMain}&lt;/boot-main&gt;
		&lt;/properties&gt;
		&lt;activation&gt;
			&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
		&lt;/activation&gt;
	&lt;/profile&gt;
	&lt;profile&gt;
		&lt;id&gt;node1&lt;/id&gt;
		&lt;properties&gt;
			&lt;activeProfile&gt;node1&lt;/activeProfile&gt;
			&lt;package-name&gt;${scripts_packageName}&lt;/package-name&gt;
			&lt;boot-main&gt;${scripts_bootMain}&lt;/boot-main&gt;
		&lt;/properties&gt;
	&lt;/profile&gt;
	&lt;profile&gt;
		&lt;id&gt;node2&lt;/id&gt;
		&lt;properties&gt;
			&lt;activeProfile&gt;node2&lt;/activeProfile&gt;
			&lt;package-name&gt;${scripts_packageName}&lt;/package-name&gt;
			&lt;boot-main&gt;${scripts_bootMain}&lt;/boot-main&gt;
		&lt;/properties&gt;
	&lt;/profile&gt;
&lt;/profiles&gt;
</code></pre>
<p>idï¼š ç”¨æ¥æŒ‡å®šä¸åŒç¯å¢ƒé…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/640-20211226222427565.png" alt="å›¾ç‰‡" loading="lazy"></figure>
<p>propertiesï¼š è¯¥èŠ‚ç‚¹ä¸­çš„èŠ‚ç‚¹æ˜¯å¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œå¦‚æˆ‘è¿™é‡Œçš„package-nameèŠ‚ç‚¹å€¼å°±å¯ä»¥åœ¨å¦å¤–çš„assembly.xmlæˆ–è€…shellè„šæœ¬æ–‡ä»¶ä¸­é€šè¿‡${package-name}è·å–åˆ°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/640-20211226222452998.png" alt="å›¾ç‰‡" loading="lazy"></figure>
<p>activeByDefaultï¼š æŒ‡å®šé»˜è®¤ç¯å¢ƒé…ç½®æ–‡ä»¶å¤¹</p>
<h2 id="maven-assembly-pluginæ‰“å‘å¸ƒå‹ç¼©åŒ…"><strong>maven-assembly-pluginæ‰“å‘å¸ƒå‹ç¼©åŒ…</strong></h2>
<p>å¯¹äºspringbootç¨‹åºæ‰“åŒ…ï¼Œå¯ä»¥åˆ†ä¸ºjarå’Œwarï¼Œè¿™é‡Œæ˜¯jaråŒ…ï¼›æœ‰åœºæ™¯æ˜¯é…ç½®æ–‡ä»¶æˆ–è€…ç¬¬ä¸‰æ–¹ç­‰ä¾èµ–åŒ…ä¸æƒ³æ”¾åˆ°å·¥ç¨‹jarä¸­ï¼Œå¹¶ä¸”æŠŠè¿™äº›æ–‡ä»¶å‹ç¼©æˆä¸€ä¸ªzipåŒ…ï¼Œæ–¹ä¾¿ä¸Šä¼ åˆ°linuxï¼›æ­¤æ—¶é€šè¿‡maven-assembly-pluginå’Œmaven-jar-pluginå°±å¯ä»¥åšåˆ°ï¼Œmvnçš„é…ç½®å¦‚ï¼š</p>
<pre><code class="language-xml">&lt;plugin&gt;
	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
	&lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
	&lt;version&gt;2.6&lt;/version&gt;
	&lt;configuration&gt;
		&lt;archive&gt;
			&lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;
			&lt;manifest&gt;
				&lt;addClasspath&gt;true&lt;/addClasspath&gt;
				&lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;
				&lt;mainClass&gt;${scripts_bootMain}&lt;/mainClass&gt;
			&lt;/manifest&gt;
		&lt;/archive&gt;
		&lt;!--æ‰“åŒ…æ’é™¤é¡¹--&gt;
		&lt;excludes&gt;
			&lt;exclude&gt;**/*.yml&lt;/exclude&gt;
			&lt;exclude&gt;**/*.properties&lt;/exclude&gt;
			&lt;exclude&gt;**/*.xml&lt;/exclude&gt;
			&lt;exclude&gt;**/*.sh&lt;/exclude&gt;
		&lt;/excludes&gt;
	&lt;/configuration&gt;
	&lt;executions&gt;
		&lt;execution&gt;
			&lt;id&gt;make-a-jar&lt;/id&gt;
			&lt;phase&gt;compile&lt;/phase&gt;
			&lt;goals&gt;
				&lt;goal&gt;jar&lt;/goal&gt;
			&lt;/goals&gt;
		&lt;/execution&gt;
	&lt;/executions&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.4&lt;/version&gt;
  &lt;!-- The configuration of the plugin --&gt;
  &lt;configuration&gt;
    &lt;!-- Specifies the configuration file of the assembly plugin --&gt;
    &lt;descriptors&gt;
      &lt;descriptor&gt;${project.basedir}/src/main/assembly/assembly.xml&lt;/descriptor&gt;
    &lt;/descriptors&gt;
  &lt;/configuration&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;make-assembly&lt;/id&gt;
      &lt;phase&gt;package&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;single&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
<p>å€¼å¾—æ³¨æ„çš„åœ°æ–¹å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>mainClassèŠ‚ç‚¹ï¼šç”¨æ¥æŒ‡å®šå¯åŠ¨mainå‡½æ•°å…¥å£ç±»è·¯å¾„ï¼Œå¦‚è¿™é‡Œçš„ï¼šcom.sm.EurekaServerApplication</li>
<li>excludesèŠ‚ç‚¹ï¼šæ’é™¤ä¸»jaråŒ…ä¸­é…ç½®ç­‰ä¸€äº›åˆ—åç¼€æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬è¦åŒ…è¿™äº›é…ç½®æ–‡ä»¶æ”¾åˆ°ä¸»åŒ…å¤–é¢</li>
<li>descriptorèŠ‚ç‚¹ï¼šç”¨æ¥æŒ‡å®šassemblyæ’ä»¶å¯¹åº”çš„assembly.xmlé…ç½®æ–‡ä»¶</li>
</ul>
<p>æœ‰äº†ä¸Šé¢mvné…ç½®ï¼Œè¿˜éœ€è¦assembly.xmlçš„é…ç½®ï¼Œè¿™é‡Œæå–äº†ç»“åˆshellè„šæœ¬å‘å¸ƒç¨‹åºçš„é…ç½®ï¼š</p>
<pre><code class="language-xml">&lt;assembly xmlns=&quot;http://maven.apache.org/ASSEMBLY/2.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
          xsi:schemaLocation=&quot;http://maven.apache.org/ASSEMBLY/2.0.0 http://maven.apache.org/xsd/assembly-2.0.0.xsd
http://maven.apache.org/ASSEMBLY/2.0.0 &quot;&gt;
    &lt;id&gt;${activeProfile}&lt;/id&gt;
    &lt;!--æ‰“åŒ…æˆä¸€ä¸ªç”¨äºå‘å¸ƒçš„zipæ–‡ä»¶--&gt;
    &lt;formats&gt;
        &lt;format&gt;zip&lt;/format&gt;
    &lt;/formats&gt;
    &lt;!--trueï¼šzipä¸­ç”Ÿæˆä¸€çº§ç›®å½•(æ­¤å¤„å±è”½ï¼Œé…åˆè„šæœ¬éœ€è¦profilesåç¼€)--&gt;
    &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
    &lt;dependencySets&gt;
        &lt;dependencySet&gt;
            &lt;!--æ‰“åŒ…è¿›zipæ–‡ä»¶çš„libç›®å½•--&gt;
            &lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;
            &lt;outputDirectory&gt;${package-name}-${activeProfile}/lib&lt;/outputDirectory&gt;
            &lt;unpack&gt;false&lt;/unpack&gt;
        &lt;/dependencySet&gt;
    &lt;/dependencySets&gt;

    &lt;fileSets&gt;
        &lt;!-- é…ç½®æ–‡ä»¶æ‰“åŒ…è¿›zipæ–‡ä»¶çš„confç›®å½• --&gt;
        &lt;fileSet&gt;
            &lt;directory&gt;${project.basedir}/src/main/profiles/${activeProfile}&lt;/directory&gt;
            &lt;outputDirectory&gt;${package-name}-${activeProfile}/conf&lt;/outputDirectory&gt;
            &lt;includes&gt;
                &lt;include&gt;**/*&lt;/include&gt;
                &lt;!--&lt;include&gt;*.xml&lt;/include&gt;--&gt;
                &lt;!--&lt;include&gt;*.properties&lt;/include&gt;--&gt;
                &lt;!--&lt;include&gt;*.yml&lt;/include&gt;--&gt;
            &lt;/includes&gt;
        &lt;/fileSet&gt;

        &lt;!--å¯åŠ¨è„šæœ¬æ‰“åŒ…è¿›zipæ–‡ä»¶--&gt;
        &lt;fileSet&gt;
            &lt;directory&gt;${project.basedir}/src/main/scripts&lt;/directory&gt;
            &lt;outputDirectory&gt;&lt;/outputDirectory&gt;
            &lt;includes&gt;
                &lt;include&gt;**/*&lt;/include&gt;
            &lt;/includes&gt;
            &lt;!-- æ–‡ä»¶æ–‡ä»¶æƒé™ä¸º777 --&gt;
            &lt;fileMode&gt;777&lt;/fileMode&gt;
            &lt;!-- ç›®å½•æƒé™ä¸º777 --&gt;
            &lt;directoryMode&gt;777&lt;/directoryMode&gt;
            &lt;!--è„šæœ¬ä¸­å‚æ•°å˜é‡ä¸ºpomä¸­çš„å€¼ å…³é”®--&gt;
            &lt;filtered&gt;true&lt;/filtered&gt;
        &lt;/fileSet&gt;

        &lt;!-- é¡¹ç›®ç¼–è¯‘å‡ºæ¥çš„jaræ‰“åŒ…è¿›zipæ–‡ä»¶ --&gt;
        &lt;fileSet&gt;
            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
            &lt;outputDirectory&gt;${package-name}-${activeProfile}/&lt;/outputDirectory&gt;
            &lt;includes&gt;
                &lt;include&gt;*.jar&lt;/include&gt;
            &lt;/includes&gt;
        &lt;/fileSet&gt;
    &lt;/fileSets&gt;
&lt;/assembly&gt;
</code></pre>
<p>é‡ç‚¹èŠ‚ç‚¹ä»‹ç»ï¼š</p>
<ul>
<li>formatsèŠ‚ç‚¹ï¼šæŠŠé…ç½®æ–‡ä»¶å’ŒjaråŒ…ç­‰å‹ç¼©æˆä»€ä¹ˆæ–‡ä»¶æ ¼å¼ï¼Œè¿™é‡Œå¯ä»¥æœ‰ï¼šzipï¼Œtarç­‰</li>
<li>fileModeèŠ‚ç‚¹ï¼šæŒ‡å®šscriptsç›®å½•ä¸‹è„šæœ¬æ–‡ä»¶(è¿™é‡Œæ˜¯ï¼šshenniu_publish.sh)åœ¨linuxä¸Šæ–‡ä»¶æƒé™ä¸º777</li>
<li>filteredèŠ‚ç‚¹ï¼šè„šæœ¬ä¸­å‚æ•°å˜é‡ä¸ºpomçš„profilesä¸­propertiesçš„å€¼(è¯¥é…ç½®ï¼Œæ˜¯æŠŠmvnä¸­å±æ€§å€¼æ˜ å°„ç”Ÿæˆåˆ°shæ–‡ä»¶ä¸­ï¼Œå¦‚ï¼š${package-name})</li>
</ul>
<p>å®Œæˆä¸Šé¢é…ç½®åï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ideaä¸Šå‹¾é€‰åˆ‡æ¢ä¸åŒç¯å¢ƒæ¥æ‰“zipåŒ…ï¼Œå¦‚å›¾ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/640-20211226223222882.png" alt="å›¾ç‰‡" loading="lazy"></figure>
<h2 id="startsh-è„šæœ¬">start.sh è„šæœ¬</h2>
<p>ä¸Šé¢æ­¥éª¤å®Œæˆäº†zipæ ¼å¼çš„å‘å¸ƒåŒ…ï¼Œæˆ‘ä»¬å†åˆ†äº«ä¸‹å¯åŠ¨ç¨‹åºçš„shellè„šæœ¬ï¼Œè¯¥è„šæœ¬å…·æœ‰çš„åŠŸèƒ½å¦‚ï¼š</p>
<ul>
<li>è§£å‹zip+å¯åŠ¨jaråŒ…</li>
<li>å¯åŠ¨jaråŒ…</li>
<li>åœæ­¢å¯¹åº”jarè¿è¡Œ</li>
<li>é‡å¯jarç¨‹åº</li>
</ul>
<p>ç›®å‰è¯¥shellä¸­å°è£…äº†ä¸¤ç§å¯åŠ¨jarå‘½ä»¤çš„æ–¹å¼ï¼š</p>
<ul>
<li>java -cp</li>
<li>java -jar</li>
</ul>
<p>å¦‚å›¾å‘½ä»¤æ ¼å¼ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/640-20211226223307412.png" alt="å›¾ç‰‡" loading="lazy"></figure>
<p>å…¨éƒ¨ shell è„šæœ¬ï¼š</p>
<pre><code class="language-shell">#!/usr/bin/env bash
#å¯å˜å‚æ•°å˜é‡
languageType=&quot;javac&quot; #æ”¯æŒ java,javac,netcore å‘å¸ƒ
#å‚æ•°å€¼ç”±pomæ–‡ä»¶ä¼ é€’
baseZipName=&quot;${package-name}-${activeProfile}&quot; #å‹ç¼©åŒ…åç§° publish-test.zipçš„publish
packageName=&quot;${package-name}&quot; #å‘½ä»¤å¯åŠ¨åŒ…å xx.jarçš„xx
mainclass=&quot;${boot-main}&quot; #java -cpå¯åŠ¨æ—¶ï¼ŒæŒ‡å®šmainå…¥å£ç±»;å‘½ä»¤ï¼šjava -cp conf;lib\*.jar;${packageName}.jar ${mainclass}

#ä¾‹å­
# baseZipName=&quot;publish-test&quot; #å‹ç¼©åŒ…åç§° publish-test.zipçš„publish
# packageName=&quot;publish&quot; #å‘½ä»¤å¯åŠ¨åŒ…å publish.jarçš„xx

#å›ºå®šå˜é‡
basePath=$(cd `dirname $0`/; pwd)
baseZipPath=&quot;${basePath}/${baseZipName}.zip&quot;  #å‹ç¼©åŒ…è·¯å¾„
baseDirPath=&quot;${basePath}&quot; #è§£å‹éƒ¨ç½²ç£ç›˜è·¯å¾„
pid= #è¿›ç¨‹pid

#è§£å‹
function shenniu_unzip()
{
    echo &quot;è§£å‹---------------------------------------------&quot;
    echo &quot;å‹ç¼©åŒ…è·¯å¾„ï¼š${baseZipPath}&quot;
    if [ ! `find ${baseZipPath}` ]
    then
        echo &quot;ä¸å­˜åœ¨å‹ç¼©åŒ…ï¼š${baseZipPath}&quot;
    else
        echo &quot;è§£å‹ç£ç›˜è·¯å¾„ï¼š${baseDirPath}/${baseZipName}&quot;
        echo &quot;å¼€å§‹è§£å‹...&quot;

        #è§£å‹å‘½ä»¤
        unzip -od ${baseDirPath}/${baseZipName} ${baseZipPath}

        #è®¾ç½®æ‰§è¡Œæƒé™
        chmod +x ${baseDirPath}/${baseZipName}/${packageName}

        echo &quot;è§£å‹å®Œæˆã€‚&quot;
    fi
}

#æ£€æµ‹pid
function getPid()
{
    echo &quot;æ£€æµ‹çŠ¶æ€---------------------------------------------&quot;
    pid=`ps -ef | grep -n ${packageName} | grep -v grep | awk '{print $2}'`
    if [ ${pid} ]
    then
        echo &quot;è¿è¡Œpidï¼š${pid}&quot;
    else
        echo &quot;æœªè¿è¡Œ&quot;
    fi
}

#å¯åŠ¨ç¨‹åº
function start()
{
    #å¯åŠ¨å‰ï¼Œå…ˆåœæ­¢ä¹‹å‰çš„
    stop
    if [ ${pid} ]
    then
        echo &quot;åœæ­¢ç¨‹åºå¤±è´¥ï¼Œæ— æ³•å¯åŠ¨&quot;
    else
        echo &quot;å¯åŠ¨ç¨‹åº---------------------------------------------&quot;

        #é€‰æ‹©è¯­è¨€ç±»å‹
        read -p &quot;è¾“å…¥ç¨‹åºç±»å‹(java,javac,netcore)ï¼Œä¸‹ä¸€æ­¥æŒ‰å›è½¦é”®(é»˜è®¤ï¼š${languageType})ï¼š&quot; read_languageType
        if [ ${read_languageType} ]
        then
            languageType=${read_languageType}
        fi
        echo &quot;é€‰æ‹©ç¨‹åºç±»å‹ï¼š${languageType}&quot;

        #è¿›å…¥è¿è¡ŒåŒ…ç›®å½•
        cd ${baseDirPath}/${baseZipName}

        #åˆ†ç±»å¯åŠ¨
        if [ &quot;${languageType}&quot; == &quot;javac&quot; ]
        then
            if [ ${mainclass} ]
            then
                nohup java -cp conf:lib\*.jar:${packageName}.jar ${mainclass} &gt;${baseDirPath}/${packageName}.out 2&gt;&amp;1 &amp;
               #nohup java -cp conf:lib\*.jar:${packageName}.jar ${mainclass} &gt;/dev/null 2&gt;&amp;1 &amp;
            fi
        elif [ &quot;${languageType}&quot; == &quot;java&quot; ]
        then
            nohup java -jar ${baseDirPath}/${baseZipName}/${packageName}.jar &gt;/dev/null 2&gt;&amp;1 &amp;
            # java -jar ${baseDirPath}/${baseZipName}/${packageName}.jar
        elif [ &quot;${languageType}&quot; == &quot;netcore&quot; ]
        then
            #nohup dotnet run ${baseDirPath}/${baseZipName}/${packageName} &gt;/dev/null 2&gt;&amp;1 &amp;
            nohup ${baseDirPath}/${baseZipName}/${packageName} &gt;/dev/null 2&gt;&amp;1 &amp;
        fi

        #æŸ¥è¯¢æ˜¯å¦æœ‰å¯åŠ¨è¿›ç¨‹
        getPid
        if [ ${pid} ]
        then
            echo &quot;å·²å¯åŠ¨&quot;
            #nohupæ—¥å¿—
            tail -n 50 -f ${baseDirPath}/${packageName}.out
        else
            echo &quot;å¯åŠ¨å¤±è´¥&quot;
        fi
    fi
}

#åœæ­¢ç¨‹åº
function stop()
{
    getPid
    if [ ${pid} ]
    then
        echo &quot;åœæ­¢ç¨‹åº---------------------------------------------&quot;
        kill -9 ${pid}

        getPid
        if [ ${pid} ]
        then
            #stop
            echo &quot;åœæ­¢å¤±è´¥&quot;
        else
            echo &quot;åœæ­¢æˆåŠŸ&quot;
        fi
    fi
}

#å¯åŠ¨æ—¶å¸¦å‚æ•°ï¼Œæ ¹æ®å‚æ•°æ‰§è¡Œ
if [ ${#} -ge 1 ]
then
    case ${1} in
        &quot;start&quot;)
            start
        ;;
        &quot;restart&quot;)
            start
        ;;
        &quot;stop&quot;)
            stop
        ;;
        &quot;unzip&quot;)
            #æ‰§è¡Œè§£å‹
            shenniu_unzip
            #æ‰§è¡Œå¯åŠ¨
            start
        ;;
        *)
            echo &quot;${1}æ— ä»»ä½•æ“ä½œ&quot;
        ;;
    esac
else
    echo &quot;
    commandå¦‚ä¸‹å‘½ä»¤ï¼š
    unzipï¼šè§£å‹å¹¶å¯åŠ¨
    startï¼šå¯åŠ¨
    stopï¼šåœæ­¢è¿›ç¨‹
    restartï¼šé‡å¯

    ç¤ºä¾‹å‘½ä»¤å¦‚ï¼š./shenniu_publish start
    &quot;
fi
</code></pre>
<p>shellä¸­çš„å‚æ•° package-nameï¼ŒactiveProfileï¼Œboot-main éƒ½æ˜¯ç”±mvnä¸­profilesçš„propertiesä¸­æä¾›ï¼Œæ˜¯å¯å˜çš„å‚æ•°ï¼Œè„šæœ¬ä»£ç æœ¬èº«ä¸éœ€è¦äººå·¥å»ä¿®æ”¹ï¼Œåªéœ€è¦å˜çš„æ˜¯mvnçš„å‚æ•°å³å¯ï¼›å…¶å®åœ¨æˆ‘ä»¬ç”ŸæˆzipåŒ…çš„æ—¶å€™ï¼Œshellä¸­çš„å‚æ•°å°±è¢«æ›¿æ¢äº†ï¼Œå¯ä»¥çœ‹zipä¸­shellæ–‡ä»¶å†…å®¹ã€‚</p>
<p>æŠŠç”Ÿæˆçš„zipä¸Šä¼ åˆ°linuxä¸Šï¼Œé€šè¿‡å‘½ä»¤è§£å‹ï¼š</p>
<pre><code class="language-shell">unzip -od eureka-server-0.0.1-node eureka-server-0.0.1-node.zip
</code></pre>
<blockquote>
<p>å¦‚æœæ˜¯åœ¨windowsä¸Šç¼–è¾‘çš„è¿™ä¸ªè„šæœ¬ï¼Œå…¶ç©ºæ ¼ç­‰å’Œlinuxä¸Šä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿è¡Œä¼šæœ‰é—®é¢˜ï¼Œè¦è§£å†³å¯ä»¥ä½¿ç”¨vimå‘½ä»¤åœ¨linuxæŠŠè¯¥æ–‡ä»¶è½¬æˆlinuxæ ¼å¼ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
</blockquote>
<pre><code class="language-shell">vim shenniu_publish.sh
set ff=unix
:wq
</code></pre>
<p>è¿è¡Œè„šæœ¬ <code>./start.sh</code></p>
<p>è¯¥è„šæœ¬æä¾›äº†å››ä¸ªå‘½ä»¤</p>
<ul>
<li>unzip è§£å‹å¹¶å¯åŠ¨</li>
<li>start å¯åŠ¨</li>
<li>stop åœæ­¢è¿›ç¨‹</li>
<li>restart é‡å¯</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Eureka æ ¸å¿ƒç‰¹æ€§]]></title>
        <id>https://sgaxun.github.io/post/spring-cloud-eureka/</id>
        <link href="https://sgaxun.github.io/post/spring-cloud-eureka/">
        </link>
        <updated>2021-05-11T14:50:21.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æœåŠ¡æ³¨å†Œ">æœåŠ¡æ³¨å†Œ</h2>
<ol>
<li>
<p>Eureka Client åœ¨ç¬¬ä¸€æ¬¡å¿ƒè·³æ—¶å‘ Eureka Server æ³¨å†Œ</p>
</li>
<li>
<p>æ³¨å†Œæ—¶ä¼šæä¾›è¯¸å¤šè‡ªèº«å…ƒæ•°æ®:ä¸»æœºåï¼Œç«¯å£ï¼Œå¥åº·æŒ‡æ ‡URLç­‰</p>
</li>
</ol>
<h2 id="æœåŠ¡ç»­çº¦">æœåŠ¡ç»­çº¦</h2>
<ol>
<li>
<p>é€šè¿‡å‘é€å¿ƒè·³è¿›è¡Œç»­çº¦,é»˜è®¤30ç§’ä¸€æ¬¡</p>
</li>
<li>
<p>90ç§’å†… Server æœªå—åˆ°ç»­çº¦,åˆ™è¿›è¡ŒæœåŠ¡å‰”é™¤</p>
</li>
</ol>
<h2 id="æœåŠ¡ä¸‹çº¿">æœåŠ¡ä¸‹çº¿</h2>
<ol>
<li>
<p>Client åœ¨ä¼˜é›…é€€å‡ºæ—¶ä¼šå‘é€ Cancel å‘½ä»¤</p>
</li>
<li>
<p>Server æ”¶åˆ° Cancel å‘½ä»¤æ—¶ä¼šåˆ é™¤è¯¥èŠ‚ç‚¹,kill -9ä¸ä¼šå‘é€ Cancel å‘½ä»¤</p>
</li>
</ol>
<h2 id="è·å–æ³¨å†Œåˆ—è¡¨ä¿¡æ¯">è·å–æ³¨å†Œåˆ—è¡¨ä¿¡æ¯</h2>
<ol>
<li>
<p>Client ä¼šç¼“å­˜ç”± Server è·å–çš„æ³¨å†Œè¡¨ä¿¡æ¯</p>
</li>
<li>
<p>Client ä¼šå®šæœŸæ›´æ–°æ³¨å†Œè¡¨ä¿¡æ¯,é»˜è®¤30ç§’ä¸€æ¬¡</p>
</li>
<li>
<p>Client ä¼šå¤„ç†æ³¨å†Œè¡¨çš„åˆå¹¶ç­‰å†…å®¹</p>
</li>
</ol>
<h2 id="å¸¸è§é¢è¯•ç‚¹">å¸¸è§é¢è¯•ç‚¹</h2>
<ul>
<li>å¤šæ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ,ä¸»è¦å’Œ Zookeeper æ¯”è¾ƒ
<ol>
<li>åˆ†å¸ƒå¼åŸºç¡€: CAPç†è®ºï¼ˆä¸€è‡´æ€§ Consistency;å¯ç”¨æ€§ Availability;åˆ†åŒºå®¹é”™æ€§ Partition toleranceï¼‰</li>
<li>å¸¸è§æ³¨å†Œä¸­å¿ƒ: Zookeeperã€Eureka ç­‰</li>
<li>Eureka ä¸»è¦ä¿è¯ AP ç‰¹æ€§</li>
<li>Zookeeper æ˜¯å…¸å‹çš„ CP ç‰¹æ€§</li>
</ol>
</li>
<li>Eureka æ³¨å†Œæ…¢
<ol>
<li>æ³¨å†Œæ…¢çš„æ ¹æœ¬åŸå› åœ¨äº Eureka çš„ AP ç‰¹æ€§</li>
<li>Eureka Client æœ‰å»¶è¿Ÿæ³¨å†Œ,é»˜è®¤30ç§’</li>
<li>Eureka Server çš„å“åº”ç¼“å­˜,é»˜è®¤30ç§’</li>
<li>Eureka Server çš„ç¼“å­˜åˆ·æ–°,é»˜è®¤30ç§’</li>
</ol>
</li>
<li>Eureka çš„è‡ªæˆ‘ä¿æŠ¤
<ol>
<li>Eureka Server ä¼šè‡ªåŠ¨æ›´æ–°ç»­çº¦çš„æ›´æ–°é˜ˆå€¼</li>
<li>Eureka Server ç»­çº¦æ›´æ–°é¢‘ç‡ä½äºé˜ˆå€¼åˆ™è¿›å…¥ä¿æŠ¤æ¨¡å¼</li>
<li>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¸‹ Eureka Server ä¸ä¼šå‰”é™¤ä»»ä½•æ³¨å†Œä¿¡æ¯</li>
</ol>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot è‡ªå®šä¹‰ Starter]]></title>
        <id>https://sgaxun.github.io/post/custom-spring-boot-starter/</id>
        <link href="https://sgaxun.github.io/post/custom-spring-boot-starter/">
        </link>
        <updated>2021-04-20T15:32:19.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>Spring Boot æœ€å¼ºå¤§çš„åŠŸèƒ½å°±æ˜¯æŠŠå¸¸ç”¨çš„åœºæ™¯æŠ½å–æˆäº†ä¸€ä¸ªä¸ª Starterï¼Œé€šè¿‡å¼•å…¥è¿™äº› Starterï¼Œå†è¿›è¡Œå°‘é‡é…ç½®å°±èƒ½ä½¿ç”¨ç›¸åº”çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰å¯åŠ¨å™¨ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨æˆ‘ä»¬çš„ç»„ç»‡å†…ä½¿ç”¨çš„å†…éƒ¨åº“ï¼Œå®ƒè¦åœ¨ Spring Boot ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼Œæœ€å¥½ä¹Ÿä¸ºå®ƒç¼–å†™ä¸€ä¸ª Starterã€‚</p>
<p>è¿™äº› starters ä½¿å¼€å‘äººå‘˜å¯ä»¥é¿å…å†—é•¿çš„é…ç½®ï¼Œå¹¶å¿«é€Ÿå¯åŠ¨ã€‚ä½†æ˜¯ç”±äºåå°å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œæœ‰æ—¶å¾ˆéš¾ç†è§£æ³¨é‡Šæˆ–ä»…ä»…åœ¨pom.xmlä¸­åŒ…å«ä¾èµ–é¡¹æ˜¯å¦‚ä½•å¯ç”¨è¿™ä¹ˆå¤šåŠŸèƒ½çš„ã€‚</p>
<h2 id="åŸç†">åŸç†</h2>
<p>ä½ å¯ä»¥åˆ°è¿™é‡ŒæŸ¥çœ‹ <a href="https://www.baeldung.com/spring-boot-custom-starter">Spring å®˜ç½‘</a>å…³äº Starter çš„ä»‹ç»ã€‚</p>
<h3 id="è‡ªåŠ¨é…ç½®ç±»">è‡ªåŠ¨é…ç½®ç±»</h3>
<p>å½“ Spring Boot å¯åŠ¨æ—¶ï¼Œå®ƒä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾åå« <em>spring.factories</em> çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½äº META-INF ç›®å½•ä¸­ã€‚ä¾‹å¦‚ä»¥ä¸‹éƒ¨åˆ†ç‰‡æ®µï¼š</p>
<pre><code class="language-shell"># Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\
org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\
org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
</code></pre>
<p>Spring Boot ä¼šè‡ªåŠ¨è£…è½½ä¸Šæ–‡é…ç½®çš„ç±»ï¼ŒRabbitMQã€Cassandraã€MongoDB å’Œ Hibernateã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ @ConditionalOnClass æ¥å†³å®šæ˜¯å¦åˆå§‹åŒ–ï¼Œä»¥ä¸‹æ˜¯ MongoAutoConfiguration ç±»ä¸­çš„ä»£ç ç‰‡æ®µã€‚</p>
<pre><code class="language-java">@Configuration
@ConditionalOnClass(MongoClient.class)
@EnableConfigurationProperties(MongoProperties.class)
@ConditionalOnMissingBean(type = &quot;org.springframework.data.mongodb.MongoDbFactory&quot;)
public class MongoAutoConfiguration {
    // configuration code
}
</code></pre>
<p>å¦‚æœç±»è·¯å¾„ä¸­æœ‰ MongoClient å¯ç”¨ï¼Œæ­¤é…ç½®ç±»å°†è¿è¡Œï¼Œå¹¶ä½¿ç”¨ç”¨é»˜è®¤é…ç½®è®¾ç½®åˆå§‹åŒ–çš„ MongoClient æ³¨å†Œæˆ Beanã€‚</p>
<h3 id="è‡ªå®šä¹‰å±æ€§">è‡ªå®šä¹‰å±æ€§</h3>
<p>ç±»ä¸­ä½¿ç”¨ @ConfigurationProperties è¯»å–é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰çš„å€¼ã€‚</p>
<pre><code class="language-java">@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)
public class MongoProperties {

    private String host;

    // other fields with standard getters and setters
}
</code></pre>
<p>å¦‚æœè¦ä¸º MongoProperties ä¸­çš„ host è‡ªå®šä¹‰å€¼ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹å³å¯</p>
<pre><code class="language-yaml">spring.data.mongodb.host = 127.0.0.1
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20211222231242742.png" alt="image-20211222231242742" loading="lazy"></figure>
<h2 id="è‡ªå®šä¹‰-starter">è‡ªå®šä¹‰ Starter</h2>
<p>äº†è§£åŸç†ä¹‹åè‡ªå®šä¹‰ä¸€ä¸ª Starter å°±å˜å¾—ç®€å•äº†ã€‚</p>
<h3 id="å‘½åè§„èŒƒ">å‘½åè§„èŒƒ</h3>
<p><strong>å®˜æ–¹ Starter</strong></p>
<ul>
<li>å‰ç¼€ï¼š spring-boot-starter-</li>
<li>æ¨¡å¼ï¼š spring-boot-starter-æ¨¡å—å</li>
<li>ä¸¾ä¾‹ï¼š spring-boot-starter-webã€spring-boot-starter-jdbc</li>
</ul>
<p><strong>è‡ªå®šä¹‰ Starter</strong></p>
<ul>
<li>åç¼€ï¼š -spring-boot-starter</li>
<li>æ¨¡å¼ï¼š æ¨¡å—-spring-boot-starter</li>
<li>è·ç¦»ï¼š mybatis-spring-boot-starter</li>
</ul>
<h3 id="åˆ›å»º-starter">åˆ›å»º Starter</h3>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª spring-boot-custom-starter çš„é¡¹ç›®ï¼Œé¡¹ç›®ä»£ç æˆ‘å·²ä¸Šä¼ åˆ°æˆ‘çš„ <a href="https://github.com/sgaxun/spring-boot-custom-starter">Github</a>ï¼ŒåŒ…å«ä¸‰ä¸ªé¡¹ç›®ï¼Œç»“æ„å¦‚ä¸‹å›¾</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20211223222801328.png" alt="image-20211223222801328" style="zoom:50%;" />
<ul>
<li>hello-autoconfigureï¼šstarter çš„å…·ä½“å®ç°æ¨¡å—</li>
<li>hello-spring-boot-starterï¼šå¼•å…¥hello-autoconfigure æ¨¡å—</li>
<li>hello-starter-testï¼šæµ‹è¯•æ¨¡å—</li>
</ul>
<h3 id="hello-autoconfigure-æ¨¡å—">hello-autoconfigure æ¨¡å—</h3>
<p>pom.xml ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot&lt;/artifactId&gt;
            &lt;version&gt;${spring-boot.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
            &lt;version&gt;${spring-boot.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
            &lt;version&gt;${spring-boot.version}&lt;/version&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

</code></pre>
<p>ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºä¸€ä¸ª HelloProperties ç”¨äºä¿å­˜é…ç½®ä¿¡æ¯</p>
<pre><code class="language-java">@ConfigurationProperties(prefix = &quot;hello.test&quot;)
public class HelloProperties {

    private String msg = &quot;hello&quot;;

    public String getMsg() {
        return msg;
    }

    public void setMsg(String msg) {
        this.msg = msg;
    }
}
</code></pre>
<p>åˆ›å»º Serviceï¼Œå®šä¹‰ getMsg æ–¹æ³•ç”¨äºè·å–é…ç½®ä¿¡æ¯</p>
<pre><code class="language-java">public class HelloService {

    private String msg;

    public HelloService(String msg) {
        this.msg = msg;
    }

    public String getMsg() {
        return this.msg;
    }
}
</code></pre>
<p>åˆ›å»ºè‡ªåŠ¨åŒ–é…ç½®ç±»</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª AutoConfigurationï¼Œå¼•ç”¨å®šä¹‰å¥½çš„é…ç½®ä¿¡æ¯</li>
<li>åœ¨ AutoConfiguration ä¸­å®ç° bean çš„æ³¨å…¥ä»¥åŠé…ç½®ä¿¡æ¯çš„è¯»å–</li>
<li>æŠŠè¿™ä¸ªç±»åŠ å…¥ spring.factories é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜</li>
</ul>
<pre><code class="language-java">@Configuration
@ConditionalOnClass(HelloService.class)
@ConditionalOnMissingBean(HelloService.class)
@EnableConfigurationProperties(HelloProperties.class)
public class HelloAutoConfiguration {

    @Autowired
    private HelloProperties helloProperties;

    @Bean
    @ConditionalOnMissingBean
    public HelloService helloService() {
        HelloService helloService = new HelloService(helloProperties.getMsg());
        return helloService;
    }
}
</code></pre>
<p>ç¼–å†™ spring.factoriesï¼Œè·¯å¾„æ˜¯ resources/META-INF</p>
<pre><code class="language-java">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  org.example.config.HelloAutoConfiguration
</code></pre>
<p>ä¸‹ä¸€æ­¥é€šè¿‡è¿è¡Œ <code>mvn install</code> å‘½ä»¤ï¼Œå°†è¿™ä¸ªé¡¹ç›®æ‰“åŒ… jar åŒ…éƒ¨ç½²åˆ°æœ¬åœ°ä»“åº“</p>
<h3 id="hello-spring-boot-starter-æ¨¡å—">hello-spring-boot-starter æ¨¡å—</h3>
<p>åªä¿ç•™ pom.xml æ–‡ä»¶ï¼Œå¼•å…¥ hello-autoconfigure æ¨¡å—</p>
<pre><code class="language-xml">&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;${spring-boot.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.example&lt;/groupId&gt;
            &lt;artifactId&gt;hello-autoconfigure&lt;/artifactId&gt;
            &lt;version&gt;${hello.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
<h3 id="hello-starter-test">hello-starter-test</h3>
<p>æµ‹è¯•æ¨¡å—ï¼Œä¾èµ– test-spring-boot-starter</p>
<p>application.yml é…ç½®æ–‡ä»¶ï¼Œä¸é…ç½®å°†ä½¿ç”¨é»˜è®¤å€¼ï¼Œè¾“å‡º helloï¼š</p>
<pre><code class="language-shell">test
	properties: hello again
</code></pre>
<p>æµ‹è¯•</p>
<pre><code class="language-java">@SpringBootApplication
public class HelloStarterTestApplication implements CommandLineRunner {

    @Resource
    HelloService helloService;

    public static void main(String[] args) {
        SpringApplication.run(HelloStarterTestApplication.class, args);
    }


    @Override
    public void run(String... args) throws Exception {
        System.out.println(this.helloService.getMsg());
    }
}
</code></pre>
<p>æµ‹è¯•æˆåŠŸå°†è¾“å‡º hello againã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åœ¨ç”¨çš„å¸¸ç”¨ Mac è½¯ä»¶]]></title>
        <id>https://sgaxun.github.io/post/mac-app/</id>
        <link href="https://sgaxun.github.io/post/mac-app/">
        </link>
        <updated>2021-02-28T15:02:45.000Z</updated>
        <content type="html"><![CDATA[<p><strong>è®°å½•ä¸€ä¸‹è‡ªå·±è§‰å¾—å¥½ç”¨çš„ Mac è½¯ä»¶</strong></p>
<h2 id="å¿…å¤‡">å¿…å¤‡</h2>
<p><a href="https://brew.sh/">Homebrew</a> - å‘½ä»¤å¼åº”ç”¨å•†åº— ğŸ‘ğŸ‘ğŸ‘</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p><a href="https://dida365.com/">æ»´ç­”æ¸…å•</a> - GTDå·¥å…·</p>
<p><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> - Java å¼€å‘å·¥å…·</p>
<p><a href="https://www.jetbrains.com/datagrip/">DataGrip</a> - æ•°æ®åº“å·¥å…·</p>
<p><a href="https://www.jetbrains.com/webstorm/">WebStorm</a> - å‰ç«¯å¼€å‘å·¥å…·</p>
<p><a href="https://www.microsoft.com/zh-cn/microsoft-365">Microsoft 365</a> - åŠå…¬å…¨å®¶æ¡¶ ğŸ‘</p>
<p><a href="https://www.islide.cc/">iSlide</a> - PPT è¾…åŠ©å·¥å…·ï¼Œè®© PPT è®¾è®¡ç®€å•èµ·æ¥ ğŸ’°</p>
<p><a href="http://www.pdmaas.cn/home">PDmaner</a> - æ•°æ®åº“å»ºæ¨¡ ğŸ‘</p>
<p><a href="https://www.sublimetext.com/">Sublime Text</a> - æ–‡æœ¬ç¼–è¾‘å™¨ ğŸ‘</p>
<p><a href="https://pdfexpert.com/zh">PDF Expert</a> - PDF å·¥å…·ã€Œæœ€è¿‘ Edge å¯¹ PDF è¶Šæ¥è¶Šå‹å¥½ã€ ğŸ’°</p>
<p><a href="https://www.notion.so/product">Notion</a> - ç¬”è®°å·¥å…· ğŸ‘ ğŸ’°</p>
<p><a href="https://iterm2.com/">iterm2</a> - ç»ˆç«¯å·¥å…· ğŸ‘</p>
<p><a href="https://fig.io/">Fig</a> - ç»ˆç«¯å‘½ä»¤è‡ªåŠ¨è¡¥å…¨å·¥å…·</p>
<p><a href="https://termius.com/">Termius</a> - SSH å·¥å…· ğŸ‘ ğŸ’°</p>
<p><a href="https://tabby.sh/">Tabby</a> - SSH å·¥å…·</p>
<p><a href="https://servercat.app/">ServerCat</a> - SSH å·¥å…·</p>
<p><a href="https://codemutex.com/">NextSSH</a> - SSH å·¥å…· ğŸ’°</p>
<p><a href="https://www.xmind.cn/">XMind</a> - è„‘å›¾å·¥å…· ğŸ’°</p>
<p><a href="https://github.com/qishibo/AnotherRedisDesktopManager">Another Redis Desktop Manager</a> - Redis å®¢æˆ·ç«¯</p>
<p><a href="https://redis.com/redis-enterprise/redis-insight/">RedisInsight</a> - å®˜æ–¹ Redis å®¢æˆ·ç«¯</p>
<p><a href="https://robomongo.org/">Robo 3T</a> - MongoDB å®¢æˆ·ç«¯</p>
<p><a href="https://www.postman.com/">PostMan</a> - Api å·¥å…·</p>
<p><a href="https://www.apifox.cn/">ApiFox</a> - API æ–‡æ¡£ã€è°ƒè¯•ã€Mockã€æµ‹è¯•ä¸€ä½“åŒ–åä½œå¹³å°</p>
<p><a href="https://www.renfei.org/snippets-lab/">SnippetsLab</a> - ä»£ç ç‰‡æ®µæ”¶é›†å·¥å…· ğŸ‘ ğŸ’°</p>
<p><a href="https://masscode.io/">massCode</a> - ä»£ç ç‰‡æ®µæ”¶é›†å·¥å…· ğŸ‘</p>
<p><a href="https://meeting.tencent.com/">è…¾è®¯ä¼šè®®</a> - è…¾è®¯ä¼šè®®</p>
<h2 id="ç¤¾äº¤">ç¤¾äº¤</h2>
<ul>
<li><a href="https://im.qq.com/">QQ</a> - QQ</li>
<li><a href="https://weibo.com/n/vvebo">VVebo</a> - ç¬¬ä¸‰æ–¹å¾®åšå®¢æˆ·ç«¯</li>
<li><a href="https://t.me/WeChatExtensionForMac">å¾®ä¿¡</a> - Macå¾®ä¿¡åŠŸèƒ½æ‹“å±•/å¾®ä¿¡æ’ä»¶/å¾®ä¿¡å°åŠ©æ‰‹ ğŸ‘</li>
<li><a href="https://arc.net/">Arc</a> - è¶…å¥½ç”¨çš„æµè§ˆå™¨ ğŸ‘</li>
<li><a href="https://menubarx.app/">MenuBarX</a> - æ”¾åœ¨ menuBar ä¸­çš„æµè§ˆå™¨ ğŸ‘ ğŸ’°</li>
<li><a href="https://mimestream.com/">Mimestream</a> - A native macOS email client for Gmail</li>
<li><a href="https://sparkmailapp.com/zh">Spark</a> - é‚®ç®±å®¢æˆ·ç«¯ ğŸ‘</li>
<li><a href="https://apps.apple.com/us/app/microsoft-outlook/id985367838?mt=12">Microsoft Outlook</a> - é‚®ç®±å®¢æˆ·ç«¯</li>
<li><a href="https://telegram.org/">Telegram</a> - ç¤¾äº¤è½¯ä»¶ã€Œç”©å‡ºå°è€Œç¾å‡ æ¡è¡—ã€ğŸ‘</li>
<li><a href="https://www.feishu.cn/">é£ä¹¦</a> - åŠå…¬ååŒ</li>
<li><a href="https://weiboformac.sinaapp.com/">Maipo</a> - ç¬¬ä¸‰æ–¹å¾®åšå·¥å…· ğŸ‘</li>
<li><a href="https://apps.apple.com/cn/app/vvebo/id670910957">VVebo</a> - ç¬¬ä¸‰æ–¹å¾®åšå·¥å…·</li>
</ul>
<h2 id="æ•ˆç‡">æ•ˆç‡</h2>
<ul>
<li><a href="https://elpass.app/">Elpass</a> - å¯†ç ç®¡ç† ğŸ‘ ğŸ’°</li>
<li><a href="https://hapigo.com/">hapigo</a> - Launcher é«˜æ•ˆå¯åŠ¨å™¨ ğŸ’°</li>
<li><a href="https://www.raycast.com/">Raycast</a> - é«˜æ•ˆå¯åŠ¨å™¨ ğŸ‘</li>
<li><a href="https://www.better365.cn/AutoSwitchInput.html">è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•</a> - å¦‚é¢˜</li>
<li><a href="https://github.com/leaves615/KeyboardHolder">keyboardHolder</a> - è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•</li>
<li><a href="https://inputsource.pro/zh-CN">input-source-pro</a> - è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³• ğŸ‘</li>
<li><a href="https://totalspaces.binaryage.com/"><s>TotalSpace</s></a> - è™šæ‹Ÿæ¡Œé¢ç®¡ç†</li>
<li><a href="https://apphousekitchen.com/">Aldente Pro</a> - ç”µæ± ç®¡ç†-ä¼˜åŒ–ç”µæ±  ğŸ‘ ğŸ’°</li>
<li><a href="https://www.parallels.com.cn/">Parallels Desktop</a> - è™šæ‹Ÿæœº ğŸ‘ ğŸ’°</li>
<li><a href="https://multipass.run/">Multipass</a> - å¿«é€Ÿæ­å»ºUbuntuè™šæ‹Ÿæœº ğŸ‘</li>
<li><a href="https://playcover.io/">PlayCover</a> - åœ¨æ‚¨çš„è‹¹æœç¡…èŠ¯ç‰‡ Mac ä¸Šæœ¬åœ°è¿è¡Œ iOS åº”ç”¨å’Œæ¸¸æˆã€‚ğŸ‘</li>
<li><a href="https://unclutterapp.com/">Unclutter</a> - éšæ‰‹è®°</li>
<li><a href="https://anydrop.io/">AnyDrop</a> - MenuBar çš„å·¥å…·åˆé›† ğŸ’°</li>
<li><a href="https://fireball.studio/oneswitch">One Switch</a> - MeunBarå¼€å…³åˆé›† ğŸ‘ ğŸ’°</li>
<li><a href="https://github.com/ripperhe/Bob">Bob</a> - ç¿»è¯‘å·¥å…· ğŸ‘ ğŸ’°</li>
<li><a href="https://www.snipaste.com/">Snipaste</a> - æˆªå›¾å·¥å…·</li>
<li><a href="https://cleanshot.com/">cleanshot X</a> - æˆªå›¾å·¥å…· ğŸ’°</li>
<li><a href="https://www.better365.cn/ishot.html">iShot</a> - æˆªå›¾å·¥å…· ğŸ‘</li>
<li><a href="https://lemon.qq.com/">Tencent Lemon</a> - è…¾è®¯æŸ æª¬æ¸…ç† ğŸ‘</li>
<li><a href="https://ezip.awehunt.com/?locale=zh-CN">MacZip</a> - è§£å‹ç¼© ğŸ‘</li>
<li><a href="https://pock.app/"><s>Pock</s></a> - TouchBarä¸ªæ€§å·¥å…·</li>
<li><a href="https://pastenow.app/">PasteNow</a> - å‰ªè´´æ¿å†å²ç®¡ç† ğŸ‘ ğŸ’°</li>
<li><a href="https://www.macbartender.com/">Bartender</a> - MenuBarå›¾æ ‡ç®¡ç† ğŸ‘ ğŸ’°</li>
<li><a href="https://ppduck.com/">PP é¸­</a> - å›¾ç‰‡å‹ç¼©</li>
<li><a href="https://nssurge.com/">Surge</a> - é«˜çº§ç½‘ç»œå·¥å…·ç®± ğŸ‘ ğŸ’°</li>
<li><a href="https://github.com/Semporia/ClashX-Pro">ClashX Pro</a> - ç§‘å­¦ä¸Šç½‘</li>
<li><a href="https://apps.apple.com/cn/app/%E5%B0%8F%E5%8E%86-%E5%B0%8F%E8%80%8C%E7%BE%8E%E7%9A%84%E6%97%A5%E5%8E%86/id1114272557?mt=12">å°å†</a> - å¥½çœ‹çš„æ—¥å†å·¥å…· ğŸ’°</li>
<li><a href="https://apps.apple.com/us/app/color-folder-master/id1450345160?mt=12">ColorFolder</a> - ä¿®æ”¹æ–‡ä»¶å¤¹é¢œè‰²</li>
<li><a href="https://www.macenhance.com/cdock.html">cDock 4</a> - ç¾åŒ– Dock æ </li>
<li><a href="https://hapigo.com/">HapiGo</a> - é«˜æ ¡å¯åŠ¨å™¨ ğŸ’°</li>
<li><a href="https://alt-tab-macos.netlify.app/">AltTab</a> - Windowsã€ŒAlt-Tabã€çª—å£åˆ‡æ¢å™¨ ğŸ‘</li>
<li><a href="https://magnet.crowdcafe.com/">Magnet</a> - ç»„ç»‡æ‚¨çš„å·¥ä½œåŒº,å¿«é€Ÿåˆ†å±</li>
<li><a href="https://wins.cool/html/index_zh.html">Wins</a> - ä¸ºMacå¸¦æ¥ç³»ç»Ÿçº§çš„åˆ†å±åŠŸèƒ½ ğŸ’°</li>
<li><a href="https://lusun.com/">èŠ¦ç¬‹</a> - æç®€å½•å±ã€ä¸€é”®åˆ†äº«ã€èŠ±æ ·äº’åŠ¨ ğŸ‘</li>
<li><a href="https://getnoir.app/">Noir</a> - Safariæµè§ˆå™¨å¤œé—´æ’ä»¶ ğŸ’°</li>
<li><a href="https://tracesof.net/uebersicht/">Ubersicht</a> - æ¡Œé¢ç¾åŒ–å·¥å…· ğŸ‘</li>
<li><a href="https://daisydiskapp.com/">DaisyDisk</a> - ç£ç›˜åˆ†æå·¥å…· ğŸ’°</li>
<li><a href="https://aibotech.cn/">èµ¤å‹ NTFS åŠ©æ‰‹</a> - Macç”µè„‘ä¸Šè¯»å†™NTFSç§»åŠ¨ç¡¬ç›˜Uç›˜ ğŸ’°</li>
<li><a href="https://www.lgerckens.de/shortery/">Shortery</a> - Mac çš„å¿«æ·æ–¹å¼è‡ªåŠ¨åŒ–</li>
<li><a href="https://flomoapp.com/">flomo Â· æµ®å¢¨ç¬”è®°</a> - æŒç»­ä¸æ–­è®°å½•ï¼Œæ„ä¹‰è‡ªç„¶æµ®ç°</li>
<li><a href="https://pilotmoon.com/popclip/">PopClip</a> - å½“æ‚¨åœ¨ Mac ä¸Šä½¿ç”¨é¼ æ ‡é€‰æ‹©æ–‡æœ¬æ—¶ï¼ŒPopClip å°±ä¼šå‡ºç°ã€‚ ğŸ’°</li>
<li><a href="https://apps.apple.com/app/opencat/id6445999201?mt=12">OpenCat</a> - ç¬¬ä¸‰æ–¹ ChatGPT,éœ€è‡ªå·±æœ‰ API KEY</li>
<li><a href="https://fliqlo.com/">fliqlo</a> - æ—¶é’Ÿå±ä¿ ğŸ‘</li>
</ul>
<h2 id="å¨±ä¹">å¨±ä¹</h2>
<ul>
<li><a href="https://www.spotify.com/hk-zh/">Spotify</a> - å¬æ­Œ ğŸ‘</li>
<li><a href="https://sspai.com/post/36884">LyricsX</a> - mac ä¸Šçš„æ­Œè¯å…¨èƒ½å·¥å…·</li>
<li><a href="https://github.com/qier222/YesPlayMusic">YesPlayMusic</a> - é«˜é¢œå€¼çš„ç¬¬ä¸‰æ–¹ç½‘æ˜“äº‘æ’­æ”¾å™¨</li>
<li><a href="https://www.pocketcasts.com/">Pocket Casts</a> - å¬æ’­å®¢ ğŸ’°</li>
<li><a href="https://software.charliemonroe.net/downie/">Dowine</a> - ä¸‹è½½ Youtube è§†é¢‘ ğŸ‘ ğŸ’°</li>
<li><a href="https://github.com/liupan1890/aliyunpan"><s>é˜¿é‡Œäº‘ç›˜å°ç™½ç¾Š</s></a> - ç¬¬ä¸‰æ–¹é˜¿é‡Œäº‘ç›˜</li>
<li><a href="https://www.bilibili.com/">bilibili-official</a> - å“”å“©å“”å“©å®˜æ–¹å®¢æˆ·ç«¯</li>
<li><a href="https://www.dbklabs.com/clicker-for-youtube/">Clicker for Youtube</a> - ç¬¬ä¸‰æ–¹ Youtube ğŸ‘ ğŸ’°</li>
<li><a href="https://www.dbklabs.com/clicker-for-netflix/">Clicker for Netflix</a> - ç¬¬ä¸‰æ–¹ Netflix ğŸ’°</li>
<li><a href="https://www.dbklabs.com/clicker-for-disney+/">Clicker for Disney+</a> - ç¬¬ä¸‰æ–¹è¿ªå£«å°¼æµåª’ä½“ ğŸ’°</li>
<li><a href="https://www.dbklabs.com/clicker-for-prime-video/">Clicker for Prime Video</a> - ç¬¬ä¸‰æ–¹äºšé©¬é€Šæµåª’ä½“ ğŸ’°</li>
<li><a href="https://apps.apple.com/us/app/amazon-prime-video/id545519333">Prime Video</a> - å®˜æ–¹</li>
<li><a href="https://iina.io/">Iina</a> - æœ¬åœ°è¶…å¼ºåª’ä½“æ’­æ”¾å™¨ ğŸ‘</li>
<li><a href="https://firecore.com/infuse">Infuse</a> - å¼ºå¤§çš„æ’­æ”¾å™¨ ğŸ‘</li>
<li><a href="https://netnewswire.com/">NetNewsWire</a> - RSS é˜…è¯»å™¨ ğŸ‘</li>
<li><a href="https://mac.xunlei.com/">è¿…é›·</a> - ä¸‹è½½å·¥å…·</li>
<li><a href="https://www.microsoft.com/en-us/microsoft-365/onedrive/online-cloud-storage">OneDrive</a> - ç½‘ç›˜</li>
<li><a href="https://pan.quark.cn/">å¤¸å…‹ç½‘ç›˜</a> - å¤¸å…‹ç½‘ç›˜</li>
</ul>
<h2 id="å·¥å…·">å·¥å…·</h2>
<ul>
<li><a href="https://github.com/tw93/Pake">Pake</a> - å¾ˆç®€å•çš„ç”¨ Rust æ‰“åŒ…ç½‘é¡µç”Ÿæˆå¾ˆå°çš„æ¡Œé¢App ğŸ‘</li>
<li><a href="https://www.smartisan.com/apps/#/handshaker">HandShaker</a> - Mac ç®¡ç† Android è®¾å¤‡ ğŸ‘</li>
<li><a href="https://macpaw.com/cleanmymac">CleanMyMac X</a> - æ¸…ç†å·¥å…·</li>
<li><a href="https://apps.apple.com/us/app/microsoft-remote-desktop/id1295203466?mt=12">Microsoft Remote Desktop</a> - å¾®è½¯å®˜æ–¹è¿œç¨‹å·¥å…· ğŸ‘</li>
<li><a href="https://www.zerotier.com/">ZeroTier</a> - å†…ç½‘ç©¿é€ ğŸ‘</li>
<li><a href="https://www.todesk.com/">ToDesk</a> - è¿œç¨‹å·¥å…· ğŸ‘</li>
<li><a href="https://er.run/">è™«æ´</a> - æ§åˆ¶æ‰‹æœº ğŸ’°</li>
<li><a href="https://tclementdev.com/timemachineeditor/">TimeMachineEditor</a> - å®šæ—¶å¤‡ä»½å·¥å…·</li>
<li><a href="https://karabiner-elements.pqrs.org/">Karabiner-elements</a> - ä¿®æ”¹é”®ç›˜æ˜ å°„ ğŸ‘</li>
<li><a href="https://imazing.com/zh">iMazing</a> - iphone å¤‡ä»½ç®¡ç† ğŸ‘ ğŸ’°</li>
<li><a href="https://qspace.awehunt.com/zh-cn/index.html">QSpace</a> - Finder æ›¿ä»£å·¥å…· ğŸ‘ ğŸ’°</li>
<li><a href="https://v2.airbuddy.app/">AirBuddy</a> - AirpodsåŠè“ç‰™è®¾å¤‡ç®¡ç† ğŸ‘ ğŸ’°</li>
<li><a href="https://www.better365.cn/bab2.html">BetterAndBetter</a> - é”®ç›˜é¼ æ ‡å¢å¼ºå·¥å…· ğŸ‘</li>
<li><a href="https://gridea.dev/">Gridea</a> - ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ ğŸ‘</li>
<li><a href="https://picgo.github.io/PicGo-Doc/">PicGo</a> - å›¾åºŠå·¥å…·</li>
<li><a href="https://typora.io/">Typora</a> - Markdown ç¼–è¾‘å™¨ ğŸ‘ ğŸ’°</li>
<li><a href="https://zh.mweb.im/">Mweb</a> - Markdown ç¼–è¾‘å™¨ ğŸ’°</li>
<li><a href="https://www.logitech.com.cn/zh-cn/product/options">Logi Option</a> - ç½—æŠ€è®¾å¤‡ç®¡ç†</li>
<li><a href="https://github.com/MonitorControl/MonitorControl">MonitorControl</a> -å¤–æ¥æ˜¾ç¤ºå™¨äº®åº¦æ§åˆ¶ ğŸ‘</li>
<li><a href="https://github.com/ts1/BLEUnlock">BLEUnlock</a> - è“ç‰™è‡ªåŠ¨é”å±è§£é” ğŸ‘</li>
<li><a href="https://max.codes/latest/">Latest</a> - è½¯ä»¶æ›´æ–°æ£€æŸ¥å™¨ ğŸ‘</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot é›†æˆ WebSocket]]></title>
        <id>https://sgaxun.github.io/post/spring-boot-websocket/</id>
        <link href="https://sgaxun.github.io/post/spring-boot-websocket/">
        </link>
        <updated>2020-12-20T15:35:50.000Z</updated>
        <content type="html"><![CDATA[<h2 id="websocket">WebSocket</h2>
<p>WebSocket åè®®æ˜¯åŸºäº TCP çš„ä¸€ç§æ–°çš„ç½‘ç»œåè®®ï¼Œæœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œæ˜¯çœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯ï¼Œå±äºæœåŠ¡å™¨æ¨é€æŠ€æœ¯çš„ä¸€ç§ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/bg2017051502.png" alt="img" loading="lazy"></figure>
<h2 id="spring-boot-æ•´åˆ">Spring Boot æ•´åˆ</h2>
<h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h3>
<p>Maven ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="å¯ç”¨-spring-boot-å¯¹-websocket-çš„æ”¯æŒ">å¯ç”¨ Spring Boot å¯¹ WebSocket çš„æ”¯æŒ</h3>
<p>é…ç½®ç±»</p>
<pre><code class="language-java">@Configuration
public class WebSocketConfig {
    @Bean
    public ServerEndpointExporter serverEndpointExporter() {
        return new ServerEndpointExporter();
    }
}
</code></pre>
<h3 id="æ ¸å¿ƒé…ç½®websocketserver">æ ¸å¿ƒé…ç½®ï¼šWebSocketServer</h3>
<p>å› ä¸ºWebSocketæ˜¯ç±»ä¼¼å®¢æˆ·ç«¯æœåŠ¡ç«¯çš„å½¢å¼(é‡‡ç”¨wsåè®®)ï¼Œé‚£ä¹ˆè¿™é‡Œçš„WebSocketServerå…¶å®å°±ç›¸å½“äºä¸€ä¸ªwsåè®®çš„Controller</p>
<ul>
<li>@ ServerEndpoint æ³¨è§£æ˜¯ä¸€ä¸ªç±»å±‚æ¬¡çš„æ³¨è§£ï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯å°†ç›®å‰çš„ç±»å®šä¹‰æˆä¸€ä¸ªwebsocketæœåŠ¡å™¨ç«¯, æ³¨è§£çš„å€¼å°†è¢«ç”¨äºç›‘å¬ç”¨æˆ·è¿æ¥çš„ç»ˆç«¯è®¿é—®URLåœ°å€,å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªURLæ¥è¿æ¥åˆ°WebSocketæœåŠ¡å™¨ç«¯</li>
<li>æ–°å»ºä¸€ä¸ªConcurrentHashMap webSocketMap ç”¨äºæ¥æ”¶å½“å‰userIdçš„WebSocketï¼Œæ–¹ä¾¿ä¼ é€’ä¹‹é—´å¯¹userIdè¿›è¡Œæ¨é€æ¶ˆæ¯ã€‚</li>
</ul>
<pre><code class="language-java">@Component
@Slf4j
@Service
@ServerEndpoint(&quot;/api/websocket/{sid}&quot;)
public class WebSocketServer {
    //é™æ€å˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰åœ¨çº¿è¿æ¥æ•°ã€‚åº”è¯¥æŠŠå®ƒè®¾è®¡æˆçº¿ç¨‹å®‰å…¨çš„ã€‚
    private static int onlineCount = 0;
    //concurrentåŒ…çš„çº¿ç¨‹å®‰å…¨Setï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„MyWebSocketå¯¹è±¡ã€‚
    private static CopyOnWriteArraySet&lt;WebSocketServer&gt; webSocketSet = new CopyOnWriteArraySet&lt;WebSocketServer&gt;();

    //ä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®
    private Session session;

    //æ¥æ”¶sid
    private String sid = &quot;&quot;;

    /**
     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•
     */
    @OnOpen
    public void onOpen(Session session, @PathParam(&quot;sid&quot;) String sid) {
        this.session = session;
        webSocketSet.add(this);     //åŠ å…¥setä¸­
        this.sid = sid;
        addOnlineCount();           //åœ¨çº¿æ•°åŠ 1
        try {
            sendMessage(&quot;conn_success&quot;);
            log.info(&quot;æœ‰æ–°çª—å£å¼€å§‹ç›‘å¬:&quot; + sid + &quot;,å½“å‰åœ¨çº¿äººæ•°ä¸º:&quot; + getOnlineCount());
        } catch (IOException e) {
            log.error(&quot;websocket IO Exception&quot;);
        }
    }

    /**
     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•
     */
    @OnClose
    public void onClose() {
        webSocketSet.remove(this);  //ä»setä¸­åˆ é™¤
        subOnlineCount();           //åœ¨çº¿æ•°å‡1
        //æ–­å¼€è¿æ¥æƒ…å†µä¸‹ï¼Œæ›´æ–°ä¸»æ¿å ç”¨æƒ…å†µä¸ºé‡Šæ”¾
        log.info(&quot;é‡Šæ”¾çš„sidä¸ºï¼š&quot;+sid);
        //è¿™é‡Œå†™ä½  é‡Šæ”¾çš„æ—¶å€™ï¼Œè¦å¤„ç†çš„ä¸šåŠ¡
        log.info(&quot;æœ‰ä¸€è¿æ¥å…³é—­ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º&quot; + getOnlineCount());

    }

    /**
     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•
     * @ Param message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯
     */
    @OnMessage
    public void onMessage(String message, Session session) {
        log.info(&quot;æ”¶åˆ°æ¥è‡ªçª—å£&quot; + sid + &quot;çš„ä¿¡æ¯:&quot; + message);
        //ç¾¤å‘æ¶ˆæ¯
        for (WebSocketServer item : webSocketSet) {
            try {
                item.sendMessage(message);
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }

    /**
     * @ Param session
     * @ Param error
     */
    @OnError
    public void onError(Session session, Throwable error) {
        log.error(&quot;å‘ç”Ÿé”™è¯¯&quot;);
        error.printStackTrace();
    }

    /**
     * å®ç°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€
     */
    public void sendMessage(String message) throws IOException {
        this.session.getBasicRemote().sendText(message);
    }

    /**
     * ç¾¤å‘è‡ªå®šä¹‰æ¶ˆæ¯
     */
    public static void sendInfo(String message, @PathParam(&quot;sid&quot;) String sid) throws IOException {
        log.info(&quot;æ¨é€æ¶ˆæ¯åˆ°çª—å£&quot; + sid + &quot;ï¼Œæ¨é€å†…å®¹:&quot; + message);

        for (WebSocketServer item : webSocketSet) {
            try {
                //è¿™é‡Œå¯ä»¥è®¾å®šåªæ¨é€ç»™è¿™ä¸ªsidçš„ï¼Œä¸ºnullåˆ™å…¨éƒ¨æ¨é€
                if (sid == null) {
//                    item.sendMessage(message);
                } else if (item.sid.equals(sid)) {
                    item.sendMessage(message);
                }
            } catch (IOException e) {
                continue;
            }
        }
    }

    public static synchronized int getOnlineCount() {
        return onlineCount;
    }

    public static synchronized void addOnlineCount() {
        WebSocketServer.onlineCount++;
    }

    public static synchronized void subOnlineCount() {
        WebSocketServer.onlineCount--;
    }

    public static CopyOnWriteArraySet&lt;WebSocketServer&gt; getWebSocketSet() {
        return webSocketSet;
    }
}
</code></pre>
<h3 id="æµ‹è¯•-controller">æµ‹è¯• Controller</h3>
<pre><code class="language-java">@Controller(&quot;web_Scoket_system&quot;)
@RequestMapping(&quot;/api/socket&quot;)
public class SystemController {
    //é¡µé¢è¯·æ±‚
    @GetMapping(&quot;/index/{userId}&quot;)
    public ModelAndView socket(@PathVariable String userId) {
        ModelAndView mav = new ModelAndView(&quot;/socket1&quot;);
        mav.addObject(&quot;userId&quot;, userId);
        return mav;
    }

    //æ¨é€æ•°æ®æ¥å£
    @ResponseBody
    @RequestMapping(&quot;/socket/push/{cid}&quot;)
    public Map pushToWeb(@PathVariable String cid, String message) {
        Map&lt;String,Object&gt; result = new HashMap&lt;&gt;();
        try {
            WebSocketServer.sendInfo(message, cid);
            result.put(&quot;code&quot;, cid);
            result.put(&quot;msg&quot;, message);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return result;
    }
}
</code></pre>
<h3 id="æµ‹è¯•é¡µé¢-indexhtml">æµ‹è¯•é¡µé¢ index.html</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

 &lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;title&gt;Javaåç«¯WebSocketçš„Tomcatå®ç°&lt;/title&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
 &lt;/head&gt;

 &lt;body&gt;
  &lt;div id=&quot;main&quot; style=&quot;width: 1200px;height:800px;&quot;&gt;&lt;/div&gt;
  Welcome&lt;br/&gt;&lt;input id=&quot;text&quot; type=&quot;text&quot; /&gt;
  &lt;button onclick=&quot;send()&quot;&gt;å‘é€æ¶ˆæ¯&lt;/button&gt;
  &lt;hr/&gt;
  &lt;button onclick=&quot;closeWebSocket()&quot;&gt;å…³é—­WebSocketè¿æ¥&lt;/button&gt;
  &lt;hr/&gt;
  &lt;div id=&quot;message&quot;&gt;&lt;/div&gt;
 &lt;/body&gt;
 &lt;script type=&quot;text/javascript&quot;&gt;
  var websocket = null;
  //åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket
  if('WebSocket' in window) {
   //æ”¹æˆä½ çš„åœ°å€
   websocket = new WebSocket(&quot;ws://192.168.100.196:8082/api/websocket/100&quot;);
  } else {
   alert('å½“å‰æµè§ˆå™¨ Not support websocket')
  }

  //è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•
  websocket.onerror = function() {
   setMessageInnerHTML(&quot;WebSocketè¿æ¥å‘ç”Ÿé”™è¯¯&quot;);
  };

  //è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•
  websocket.onopen = function() {
   setMessageInnerHTML(&quot;WebSocketè¿æ¥æˆåŠŸ&quot;);
  }
  var U01data, Uidata, Usdata
  //æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•
  websocket.onmessage = function(event) {
   console.log(event);
   setMessageInnerHTML(event);
   setechart()
  }

  //è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•
  websocket.onclose = function() {
   setMessageInnerHTML(&quot;WebSocketè¿æ¥å…³é—­&quot;);
  }

  //ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚
  window.onbeforeunload = function() {
   closeWebSocket();
  }

  //å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š
  function setMessageInnerHTML(innerHTML) {
   document.getElementById('message').innerHTML += innerHTML + '&lt;br/&gt;';
  }

  //å…³é—­WebSocketè¿æ¥
  function closeWebSocket() {
   websocket.close();
  }

  //å‘é€æ¶ˆæ¯
  function send() {
   var message = document.getElementById('text').value;
   websocket.send('{&quot;msg&quot;:&quot;' + message + '&quot;}');
   setMessageInnerHTML(message + &quot;&amp;#13;&quot;);
  }
 &lt;/script&gt;

&lt;/html&gt;
</code></pre>
<h3 id="ç»“æœå±•ç¤º">ç»“æœå±•ç¤º</h3>
<p>åå°è¾“å‡º</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20211226214558708.png" alt="image-20211226214558708" loading="lazy"></figure>
<p>å‰å°æ˜¾ç¤º</p>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/640.png" alt="å›¾ç‰‡" loading="lazy"></figure>
<h3 id="é—®é¢˜">é—®é¢˜</h3>
<p>ç”±äº WebSocket å¯åŠ¨æ—¶ä¼˜å…ˆäº Spring å®¹å™¨ï¼Œä»è€Œå¯¼è‡´åœ¨ WebSocketServer ä¸­è°ƒç”¨ä¸šåŠ¡ä¼šç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ‰€ä»¥éœ€è¦åœ¨ WebSocketServer ä¸­å°†ç”¨åˆ°çš„ service ç»™é™æ€åˆå§‹åŒ–</p>
<pre><code class="language-java">public static ITestService testService;
</code></pre>
<p>WebSocketConfig ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹</p>
<pre><code class="language-java">@Autowired
private void setTestService(ITestService testService){
	Websocketserver.testService = testService:
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot å¯åŠ¨æµç¨‹]]></title>
        <id>https://sgaxun.github.io/post/spring-boot-start-process/</id>
        <link href="https://sgaxun.github.io/post/spring-boot-start-process/">
        </link>
        <updated>2020-10-21T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<p>Spring Boot çš„å¯åŠ¨å¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@SpringBootApplication
public class Application implements CommandLineRunner {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
 }
</code></pre>
<p>å¯åŠ¨ç±»ä¸Šæ ‡æ³¨ @SpringBootApplication æ³¨è§£ï¼Œç„¶ååœ¨ main å‡½æ•°ä¸­è°ƒç”¨ <code>SpringApplication.run(Application.class, args);</code>,è¿™æ ·å°±å®Œæˆäº† Spring Boot çš„å¯åŠ¨æµç¨‹ï¼Œå†™æ³•éå¸¸ç®€å•ã€‚</p>
<h2 id="springbootapplication">@SpringBootApplication</h2>
<p>é¦–å…ˆæŸ¥çœ‹å¯åŠ¨ç±»ä¸Šçš„æ³¨è§£ @SpringBootApplication æºç ï¼š</p>
<pre><code class="language-java">@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(excludeFilters = {
  @Filter(type = FilterType.CUSTOM,classes = {TypeExcludeFilter.class}), 
  @Filter(type = FilterType.CUSTOM,classes = {AutoConfigurationExcludeFilter.class}
)}
)
public @interface SpringBootApplication {
    @AliasFor(
        annotation = EnableAutoConfiguration.class
    )
    Class&lt;?&gt;[] exclude() default {};

    @AliasFor(
        annotation = EnableAutoConfiguration.class
    )
    String[] excludeName() default {};

    @AliasFor(
        annotation = ComponentScan.class,
        attribute = &quot;basePackages&quot;
    )
    String[] scanBasePackages() default {};

    @AliasFor(
        annotation = ComponentScan.class,
        attribute = &quot;basePackageClasses&quot;
    )
    Class&lt;?&gt;[] scanBasePackageClasses() default {};

    @AliasFor(
        annotation = ComponentScan.class,
        attribute = &quot;nameGenerator&quot;
    )
    Class&lt;? extends BeanNameGenerator&gt; nameGenerator() default BeanNameGenerator.class;

    @AliasFor(
        annotation = Configuration.class
    )
    boolean proxyBeanMethods() default true;
}
</code></pre>
<p>æŸ¥çœ‹æºç å¯ä»¥çœ‹å‡ºæ¥ @SpringBootApplication æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œä¸»è¦ç”± @SpringBootConfigurationï¼Œ@EnableAutoConfiguration å’Œ @EnableAutoConfiguration è¿™ä¸‰ä¸ªæ³¨è§£ç»„æˆã€‚</p>
<p>@SpringBootApplication ä¸»è¦ä½œä¸ºä¸€ä¸ªé…ç½®ç±»ï¼Œèƒ½å¤Ÿå‡ºå‘åŒ…æ‰«æå’Œè‡ªåŠ¨é…ç½®çš„é€»è¾‘ï¼Œä»è€Œä½¿ Spring Boot ç›¸å…³çš„ bean è¢«æ³¨å†Œè¿› Spring å®¹å™¨ã€‚</p>
<h2 id="å¯åŠ¨æµç¨‹">å¯åŠ¨æµç¨‹</h2>
<p>main æ–¹æ³•ä¸­ä»…æœ‰ä¸€è¡Œä»£ç ï¼Œ<code>SpringApplication.run(Application.class, args);</code>è¿›å…¥ run æ–¹æ³•æŸ¥çœ‹æºç ã€‚</p>
<pre><code class="language-java">public static ConfigurableApplicationContext run(Class&lt;?&gt; primarySource, String... args) {
        return run(new Class[]{primarySource}, args);
    }
</code></pre>
<p>ä¸Šè¾¹çš„ run æ–¹æ³•ä¸­åˆè°ƒç”¨äº†å¦ä¸€ä¸ªé™æ€ run æ–¹æ³•ï¼š</p>
<pre><code class="language-java">public static ConfigurableApplicationContext run(Class&lt;?&gt;[] primarySources, String[] args) {
        return (new SpringApplication(primarySources)).run(args);
    }
</code></pre>
<p>ä¸Šè¾¹çš„ run æ–¹æ³•ä¸­æ„å»ºäº†ä¸€ä¸ª SpringApplication å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶ run æ–¹æ³•æ¥å¯åŠ¨ Spring Boot é¡¹ç›®ï¼ŒæŸ¥çœ‹ SpringApplication å¯¹è±¡çš„run æ–¹æ³•æºç ï¼š</p>
<pre><code class="language-java">public ConfigurableApplicationContext run(String... args) {
        StopWatch stopWatch = new StopWatch();
        stopWatch.start();
        ConfigurableApplicationContext context = null;
        Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList();
        this.configureHeadlessProperty();
        SpringApplicationRunListeners listeners = this.getRunListeners(args);
        listeners.starting();

        Collection exceptionReporters;
        try {
            ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
            ConfigurableEnvironment environment = this.prepareEnvironment(listeners, applicationArguments);
            this.configureIgnoreBeanInfo(environment);
            Banner printedBanner = this.printBanner(environment);
            context = this.createApplicationContext();
            exceptionReporters = this.getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[]{ConfigurableApplicationContext.class}, context);
            this.prepareContext(context, environment, listeners, applicationArguments, printedBanner);
            this.refreshContext(context);
            this.afterRefresh(context, applicationArguments);
            stopWatch.stop();
            if (this.logStartupInfo) {
                (new StartupInfoLogger(this.mainApplicationClass)).logStarted(this.getApplicationLog(), stopWatch);
            }

            listeners.started(context);
            this.callRunners(context, applicationArguments);
        } catch (Throwable var10) {
            this.handleRunFailure(context, var10, exceptionReporters, listeners);
            throw new IllegalStateException(var10);
        }

        try {
            listeners.running(context);
            return context;
        } catch (Throwable var9) {
            this.handleRunFailure(context, var9, exceptionReporters, (SpringApplicationRunListeners)null);
            throw new IllegalStateException(var9);
        }
    }
</code></pre>
<h3 id="å¯åŠ¨æ­¥éª¤">å¯åŠ¨æ­¥éª¤</h3>
<ol>
<li>
<p>ä»<code>spring.factories</code>é…ç½®æ–‡ä»¶ä¸­<strong>åŠ è½½</strong><code>**EventPublishingRunListener**</code><strong>å¯¹è±¡</strong>ï¼Œè¯¥å¯¹è±¡æ‹¥æœ‰<code>SimpleApplicationEventMulticaster</code>å±æ€§ï¼Œå³åœ¨SpringBootå¯åŠ¨è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µç”¨æ¥å‘å°„å†…ç½®çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</p>
</li>
<li>
<p><strong>å‡†å¤‡ç¯å¢ƒå˜é‡</strong>ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå˜é‡ï¼Œç¯å¢ƒå˜é‡ï¼Œå‘½ä»¤è¡Œå‚æ•°ï¼Œé»˜è®¤å˜é‡ï¼Œ<code>servlet</code>ç›¸å…³é…ç½®å˜é‡ï¼Œéšæœºå€¼ä»¥åŠé…ç½®æ–‡ä»¶ï¼ˆæ¯”å¦‚<code>application.properties</code>ï¼‰ç­‰ã€‚</p>
</li>
<li>
<p>æ§åˆ¶å°**æ‰“å°SpringBootçš„<code>bannner</code>æ ‡å¿—ã€‚</p>
</li>
<li>
<p><strong>æ ¹æ®ä¸åŒç±»å‹ç¯å¢ƒåˆ›å»ºä¸åŒç±»å‹çš„<code>applicationcontext</code>å®¹å™¨</strong>ï¼Œå› ä¸ºè¿™é‡Œæ˜¯<code>servlet</code>ç¯å¢ƒï¼Œæ‰€ä»¥åˆ›å»ºçš„æ˜¯<code>AnnotationConfigServletWebServerApplicationContext</code>å®¹å™¨å¯¹è±¡ã€‚</p>
</li>
<li>
<p>ä»<code>spring.factories</code>é…ç½®æ–‡ä»¶ä¸­<strong>åŠ è½½</strong><code>**FailureAnalyzers**</code><strong>å¯¹è±¡</strong>,ç”¨æ¥æŠ¥å‘ŠSpringBootå¯åŠ¨è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ã€‚</p>
</li>
<li>
<p><strong>ä¸ºåˆšåˆ›å»ºçš„å®¹å™¨å¯¹è±¡åšä¸€äº›åˆå§‹åŒ–å·¥ä½œ</strong>ï¼Œå‡†å¤‡ä¸€äº›å®¹å™¨å±æ€§å€¼ç­‰ï¼Œå¯¹<code>ApplicationContext</code>åº”ç”¨ä¸€äº›ç›¸å…³çš„åç½®å¤„ç†å’Œè°ƒç”¨å„ä¸ª<code>ApplicationContextInitializer</code>çš„åˆå§‹åŒ–æ–¹æ³•æ¥æ‰§è¡Œä¸€äº›åˆå§‹åŒ–é€»è¾‘ç­‰ã€‚</p>
</li>
<li>
<p><strong>åˆ·æ–°å®¹å™¨</strong>ï¼Œè¿™ä¸€æ­¥è‡³å…³é‡è¦ã€‚æ¯”å¦‚è°ƒç”¨<code>bean factory</code>çš„åç½®å¤„ç†å™¨ï¼Œæ³¨å†Œ<code>BeanPostProcessor</code>åç½®å¤„ç†å™¨ï¼Œåˆå§‹åŒ–äº‹ä»¶å¹¿æ’­å™¨ä¸”å¹¿æ’­äº‹ä»¶ï¼Œåˆå§‹åŒ–å‰©ä¸‹çš„å•ä¾‹<code>bean</code>å’ŒSpringBootåˆ›å»ºå†…åµŒçš„<code>Tomcat</code>æœåŠ¡å™¨ç­‰ç­‰é‡è¦ä¸”å¤æ‚çš„é€»è¾‘éƒ½åœ¨è¿™é‡Œå®ç°ï¼Œä¸»è¦æ­¥éª¤å¯è§ä»£ç çš„æ³¨é‡Šï¼Œå…³äºè¿™é‡Œçš„é€»è¾‘ä¼šåœ¨ä»¥åçš„springæºç åˆ†æä¸“é¢˜è¯¦ç»†åˆ†æã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡Œåˆ·æ–°å®¹å™¨åçš„åç½®å¤„ç†é€»è¾‘</strong>ï¼Œæ³¨æ„è¿™é‡Œä¸ºç©ºæ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>è°ƒç”¨<code>ApplicationRunner</code>å’Œ<code>CommandLineRunner</code>çš„runæ–¹æ³•</strong>ï¼Œæˆ‘ä»¬å®ç°è¿™ä¸¤ä¸ªæ¥å£å¯ä»¥åœ¨springå®¹å™¨å¯åŠ¨åéœ€è¦çš„ä¸€äº›ä¸œè¥¿æ¯”å¦‚åŠ è½½ä¸€äº›ä¸šåŠ¡æ•°æ®ç­‰ã€‚</p>
</li>
<li>
<p><strong>æŠ¥å‘Šå¯åŠ¨å¼‚å¸¸</strong>ï¼Œå³è‹¥å¯åŠ¨è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶ç”¨<code>FailureAnalyzers</code>æ¥æŠ¥å‘Šå¼‚å¸¸ã€‚</p>
</li>
<li>
<p>æœ€ç»ˆ<strong>è¿”å›å®¹å™¨å¯¹è±¡</strong>ï¼Œè¿™é‡Œè°ƒç”¨æ–¹æ³•æ²¡æœ‰å£°æ˜å¯¹è±¡æ¥æ¥æ”¶ã€‚</p>
<p>å½“ç„¶åœ¨SpringBootå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªä¸åŒçš„å¯åŠ¨é˜¶æ®µä¼šåˆ†åˆ«å‘å°„ä¸åŒçš„å†…ç½®ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæ¯”å¦‚åœ¨å‡†å¤‡<code>environment</code>å‰ä¼šå‘å°„<code>ApplicationStartingEvent</code>äº‹ä»¶ï¼Œåœ¨<code>environment</code>å‡†å¤‡å¥½åä¼šå‘å°„<code>ApplicationEnvironmentPreparedEvent</code>äº‹ä»¶ï¼Œåœ¨åˆ·æ–°å®¹å™¨å‰ä¼šå‘å°„<code>ApplicationPreparedEvent</code>äº‹ä»¶ç­‰ï¼Œæ€»ä¹‹SpringBootæ€»å…±å†…ç½®äº†7ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œé™¤äº†æ ‡å¿—SpringBootçš„ä¸åŒå¯åŠ¨é˜¶æ®µå¤–ï¼ŒåŒæ—¶ä¸€äº›ç›‘å¬å™¨ä¹Ÿä¼šç›‘å¬ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä»è€Œæ‰§è¡Œä¸€äº›å¯åŠ¨åˆå§‹åŒ–é€»è¾‘ã€‚</p>
</li>
</ol>
<p>æ¢³ç†è¿‡åèƒ½å¤Ÿç®€å•çš„å¯¹ Spring Boot æœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JVM åŸç†æ¢ç©¶ä¹‹äºŒ]]></title>
        <id>https://sgaxun.github.io/post/jvm-deepin-2/</id>
        <link href="https://sgaxun.github.io/post/jvm-deepin-2/">
        </link>
        <updated>2020-09-18T15:50:10.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å†…å­˜åˆ†é…">å†…å­˜åˆ†é…</h2>
<h3 id="jvm-çš„ç®€åŒ–æ¶æ„">JVM çš„ç®€åŒ–æ¶æ„</h3>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/20220112162308.png" style="zoom:50%;" />
<h4 id="è¿è¡Œæ—¶æ•°æ®åŒº">è¿è¡Œæ—¶æ•°æ®åŒº</h4>
<p>åŒ…æ‹¬ï¼šPC å¯„å­˜å™¨ã€Java è™šæ‹Ÿæœºæ ˆã€Java å †ã€æ–¹æ³•åŒºã€è¿è¡Œæ—¶å¸¸é‡æ± ã€æœ¬åœ°æ–¹æ³•æ ˆç­‰ã€‚</p>
<ul>
<li>PC(Program Counter)å¯„å­˜å™¨è¯´æ˜ï¼š</li>
</ul>
<ol>
<li>æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ä¸€ä¸ª PC å¯„å­˜å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</li>
<li>åœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ï¼Œåˆ›å»ºç›¸åº”çš„ PC å¯„å­˜å™¨ã€‚</li>
<li>æ‰§è¡Œæœ¬åœ°æ–¹æ³•æ—¶ï¼ŒPC å¯„å­˜å™¨çš„å€¼ä¸º undefinedã€‚</li>
<li>æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ JVM è§„èŒƒä¸­æ²¡æœ‰è§„å®š OutOfMemoryError çš„å†…å­˜åŒºåŸŸã€‚</li>
</ol>
<ul>
<li>Java è™šæ‹Ÿæœºæ ˆ</li>
</ul>
<p>æ ˆç”±ä¸€ç³»åˆ—å¸§ï¼ˆFrameï¼‰ç»„æˆï¼ˆå› æ­¤ Java æ ˆä¹Ÿå«åšå¸§æ ˆï¼‰ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p>
<p>å¸§ç”¨æ¥ä¿å­˜ä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆï¼ˆJava æ²¡æœ‰å¯„å­˜å™¨ï¼Œæ‰€æœ‰å‚æ•°ä¼ é€’ä½¿ç”¨æ“ä½œæ•°æ ˆï¼‰ã€å¸¸é‡æ± æŒ‡é’ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›å€¼ç­‰ã€‚</p>
<p>æ¯æ¬¡æ–¹æ³•è°ƒç”¨åˆ›å»ºä¸€ä¸ªå¸§ï¼Œå¹¶å‹æ ˆï¼Œé€€å‡ºæ–¹æ³•çš„æ—¶å€™ï¼Œä¿®æ”¹æ ˆé¡¶æŒ‡é’ˆå°±å¯ä»¥æŠŠæ ˆå¸§ä¸­çš„å†…å®¹é”€æ¯ã€‚</p>
<p>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼Œæ¯ä¸ª slot å­˜æ”¾ 32 ä½çš„æ•°æ®ï¼Œlongã€double å ä¸¤ä¸ªæ§½ä½ã€‚</p>
<p>æ ˆçš„ä¼˜ç‚¹ï¼šå­˜å–é€Ÿåº¦æ¯”å †å¿«ï¼Œä»…æ¬¡äºå¯„å­˜å™¨ã€‚</p>
<p>æ ˆçš„ç¼ºç‚¹ï¼šå­˜åœ¨æ ˆä¸­çš„æ•°æ®å¤§å°ã€ç”Ÿå­˜æœŸæ˜¯åœ¨ç¼–è¯‘æœŸå†³å®šçš„ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</p>
<ul>
<li>Java å †</li>
</ul>
<p>ç”¨æ¥å­˜æ”¾åº”ç”¨ç³»ç»Ÿåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº« Java å †ã€‚</p>
<p>GC ä¸»è¦å°±ç®¡ç†å †ç©ºé—´ï¼Œå¯¹åˆ†ä»£ GC æ¥è¯´ï¼Œå †ä¹Ÿæ˜¯åˆ†ä»£çš„ã€‚</p>
<p>å †çš„ä¼˜ç‚¹ï¼šè¿è¡ŒæœŸåŠ¨æ€åˆ†é…å†…å­˜å¤§å°ï¼Œè‡ªè¡Œè¿›è¡Œåƒåœ¾å›æ”¶ï¼š</p>
<p>å †çš„ç¼ºç‚¹ï¼šæ•ˆç‡ç›¸å¯¹è¾ƒæ…¢ã€‚</p>
<ul>
<li>æ–¹æ³•åŒº</li>
</ul>
<p>æ–¹æ³•åŒºæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œé€šå¸¸ç”¨æ¥ä¿å­˜è£…è½½çš„ç±»çš„ç»“æ„ä¿¡æ¯ã€‚</p>
<p>é€šå¸¸æ–¹æ³•åŒºæ˜¯å’Œå…ƒç©ºé—´å…³è”åœ¨ä¸€èµ·ï¼Œä½†å…·ä½“çš„è·Ÿ JVM å®ç°å’Œç‰ˆæœ¬æœ‰å…³ã€‚</p>
<p>JVM è§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªåˆ«ç§°ä¸º Non-heapï¼ˆéå †ï¼‰ï¼Œåº”æ˜¯ä¸ºäº†ä¸ Java å †åŒºåˆ†å¼€ã€‚</p>
<ul>
<li>è¿è¡Œæ—¶å¸¸é‡æ± </li>
</ul>
<p>æ˜¯ Class æ–‡ä»¶ä¸­æ¯ä¸ªç±»æˆ–è€…æ¥å£çš„å¸¸é‡æ± è¡¨ï¼Œåœ¨è¿è¡ŒæœŸé—´çš„è¡¨ç¤ºå½¢å¼ï¼Œé€šå¸¸åŒ…æ‹¬ï¼šç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰ä¿¡æ¯ã€‚</p>
<p>åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚</p>
<p>é€šå¸¸åœ¨åŠ è½½ç±»å’Œæ¥å£åˆ° JVM åï¼Œå°±åˆ›å»ºç›¸åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± </p>
<ul>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
</ul>
<p>åœ¨ JVM ä¸­ç”¨æ¥æ”¯æŒ native æ–¹æ³•æ‰§è¡Œçš„æ ˆå°±æ˜¯æœ¬åœ°æ–¹æ³•æ ˆã€‚</p>
<h3 id="æ ˆ-å †-æ–¹æ³•åŒºä¹‹é—´çš„äº¤äº’å…³ç³»">æ ˆã€å †ã€æ–¹æ³•åŒºä¹‹é—´çš„äº¤äº’å…³ç³»</h3>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220112211911109.png" alt="image-20220112211911109" loading="lazy"></figure>
<h2 id="java-å †å†…å­˜">Java å †å†…å­˜</h2>
<h3 id="å †çš„ç»“æ„-å¯¹è±¡çš„å†…å­˜å¸ƒå±€">å †çš„ç»“æ„ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3>
<h4 id="æ¦‚è¿°">æ¦‚è¿°</h4>
<ul>
<li>
<p>Java å †ç”¨æ¥å­˜æ”¾åº”ç”¨ç³»ç»Ÿåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº« Java å †ã€‚</p>
</li>
<li>
<p>Java å †æ˜¯åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ†é…å†…å­˜å¤§å°ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
</li>
<li>
<p>Java åƒåœ¾å›æ”¶ï¼›ï¼ˆGCï¼‰ä¸»è¦å°±æ˜¯å›æ”¶å †å†…å­˜ï¼Œå¯¹åˆ†ä»£ GC æ¥è¯´ï¼Œå †ä¹Ÿæ˜¯åˆ†ä»£çš„ã€‚</p>
</li>
</ul>
<h4 id="java-å †çš„ç»“æ„">Java å †çš„ç»“æ„</h4>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220112212840118.png" alt="image-20220112212840118" loading="lazy"></figure>
<ul>
<li>æ–°ç”Ÿä»£ç”¨æ¥å­˜æ”¾æ–°åˆ†é…çš„å¯¹è±¡;æ–°ç”Ÿä»£ä¸­ç»è¿‡åƒåœ¾å›æ”¶ï¼Œæ²¡æœ‰å›æ”¶æ‰çš„å¯¹è±¡ï¼Œè¢«å¤åˆ¶åˆ°è€å¹´ä»£</li>
<li>è€å¹´ä»£å­˜å‚¨å¯¹è±¡æ¯”æ–°ç”Ÿä»£å­˜å‚¨å¯¹è±¡çš„å¹´é¾„å¤§çš„å¤š</li>
<li>è€å¹´ä»£å­˜å‚¨ä¸€äº›å¤§çš„å¯¹è±¡</li>
<li>æ•´ä¸ªå †çš„å¤§å° = æ–°ç”Ÿä»£ + è€å¹´ä»£</li>
<li>æ–°ç”Ÿä»£ = Eden + å­˜æ´»åŒº(From + To)</li>
<li>ä»å‰çš„æŒä¹…ä»£ï¼Œç”¨æ¥å­˜æ”¾ Classã€Method ç­‰å…ƒç´ çš„åŒºåŸŸï¼Œä» JDK8 å¼€å§‹å»æ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ï¼ˆMetaSpaceï¼‰ï¼Œå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºé‡Œé¢ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°å†…å­˜</li>
</ul>
<h4 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h4>
<p>å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€ï¼ˆè¿™é‡Œä»¥ HotSpot è™šæ‹Ÿæœºä¸ºä¾‹æ¥è¯´æ˜ï¼‰ï¼Œåˆ†ä¸ºï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……</p>
<ul>
<li>å¯¹è±¡å¤´ï¼ŒåŒ…å«ä¸¤éƒ¨åˆ†ï¼š</li>
</ul>
<ol>
<li>Mark Wordï¼šå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ•°æ®ï¼Œå¦‚ HashCodeã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰</li>
<li>ç±»å‹æŒ‡é’ˆï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆ</li>
</ol>
<ul>
<li>å®ä¾‹æ•°æ®</li>
</ul>
<p>çœŸæ­£å­˜æ”¾å¯¹è±¡å®ä¾‹æ•°æ®çš„åœ°æ–¹</p>
<ul>
<li>å¯¹é½å¡«å……</li>
</ul>
<p>è¿™éƒ¨åˆ†ä¸ä¸€å®šå­˜åœ¨ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å«ä¹‰ï¼Œä»…ä»…æ˜¯å ä½ç¬¦ã€‚å› ä¸º HotSpot è¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€éƒ½æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±å¯¹é½</p>
<h3 id="å¯¹è±¡çš„è®¿é—®å®šä½">å¯¹è±¡çš„è®¿é—®å®šä½</h3>
<p>åœ¨ JVM è§„èŒƒä¸­åªè§„å®šäº† reference ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ²¡æœ‰è§„å®šè¿™ä¸ªå¼•ç”¨å¦‚ä½•å»å®šä½ã€è®¿é—®å †ä¸­å¯¹è±¡çš„å…·ä½“ä½ç½®</p>
<p>å› æ­¤å¯¹è±¡çš„è®¿é—®æ–¹å¼å–å†³äº JVM çš„å®ç°ï¼Œç›®å‰ä¸»æµçš„æœ‰ï¼šä½¿ç”¨å¥æŸ„æˆ–ä½¿ç”¨æŒ‡é’ˆä¸¤ç§æ–¹å¼</p>
<h4 id="ä½¿ç”¨å¥æŸ„">ä½¿ç”¨å¥æŸ„</h4>
<p>Java å †ä¸­ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥åšå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨å¥æŸ„çš„åœ°å€ï¼Œå¥æŸ„ä¸­å­˜å‚¨å¯¹è±¡çš„å®ä¾‹æ•°æ®å’Œç±»å…ƒæ•°æ®çš„åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220112214935654.png" alt="image-20220112214935654" loading="lazy"></figure>
<h4 id="ä½¿ç”¨æŒ‡é’ˆ">ä½¿ç”¨æŒ‡é’ˆ</h4>
<p>Java å †ä¸­ä¼šå­˜æ”¾è®¿é—®ç±»å…ƒæ•°æ®çš„åœ°å€ï¼Œreference å­˜å‚¨çš„å°±ç›´æ¥æ˜¯å¯¹è±¡çš„åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/Snipaste_2022-01-12_21-54-53.png" alt="Snipaste_2022-01-12_21-54-53" loading="lazy"></figure>
<h3 id="java-å†…å­˜åˆ†é…å‚æ•°">Java å†…å­˜åˆ†é…å‚æ•°</h3>
<h4 id="trace-è·Ÿè¸ªå‚æ•°">Trace è·Ÿè¸ªå‚æ•°</h4>
<p>å¯ä»¥æ‰“å° GC çš„ç®€è¦ä¿¡æ¯ï¼š -Xlog:gc</p>
<p>æ‰“å° GC çš„ä¿¡æ¯ä¿¡æ¯ï¼š-Xlog:gc*</p>
<p>æŒ‡å®š GC log çš„ä½ç½®ï¼Œä»¥æ–‡ä»¶è¾“å‡ºï¼š-Xlog:gc:garbage-collection.log</p>
<p>æ¯ä¸€æ¬¡ GC åï¼Œéƒ½æ‰“å°å †ä¿¡æ¯ï¼š-Xlog:gc+heap=debug</p>
<h4 id="gc-æ—¥å¿—æ ¼å¼">GC æ—¥å¿—æ ¼å¼</h4>
<ul>
<li>GC å‘ç”Ÿçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ JVM å¯åŠ¨ä»¥ä¸ºç»è¿‡çš„ç§’æ•°</li>
<li>æ—¥å¿—çº§åˆ«ä¿¡æ¯ï¼Œå’Œæ—¥å¿—ç±»å‹æ ‡è®°</li>
<li>GC è¯†åˆ«å·</li>
<li>GC ç±»å‹å’Œè¯´æ˜ GC çš„åŸå› </li>
<li>å®¹é‡ï¼šGC å‰å®¹é‡-&gt;GC åå®¹é‡(è¯¥åŒºåŸŸæ€»å®¹é‡)</li>
<li>GCæŒç»­æ—¶é—´ï¼Œå•ä½ç§’ã€‚æœ‰çš„æ”¶é›†å™¨ä¼šæœ‰æ›´è¯¦ç»†çš„æè¿°ï¼Œæ¯”å¦‚ï¼šuser è¡¨ç¤ºåº”ç”¨ç¨‹åºæ¶ˆè€—çš„æ—¶é—´ï¼Œsys è¡¨ç¤ºç³»ç»Ÿå†…æ ¸æ¶ˆè€—çš„æ—¶é—´ï¼Œreal è¡¨ç¤ºæ“ä½œä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´</li>
</ul>
<h4 id="java-å †çš„å‚æ•°">Java å †çš„å‚æ•°</h4>
<ul>
<li>-Xmsï¼šåˆå§‹å †å¤§å°ï¼Œé»˜è®¤ç‰©ç†å†…å­˜çš„ 1/64ï¼Œå¿…é¡»æ˜¯ 1024 çš„å€æ•°å¹¶ä¸”å¤§äº 1MB</li>
<li>-Xmxï¼šæœ€å¤§å †å¤§å°ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„ 1/4ï¼Œå¿…é¡»æ˜¯ 1024 çš„å€æ•°ä¸”å¤§äº 2MB</li>
<li>-Xmnï¼šæ–°ç”Ÿä»£å¤§å°ï¼Œé»˜è®¤æ˜¯æ•´ä¸ªå †çš„ 3/8</li>
<li>-XX:NewRatioï¼šè€å¹´ä»£ä¸æ–°ç”Ÿä»£çš„æ¯”ä¾‹å…³ç³»ã€‚ã€Œå¦‚æœ xms=xmxï¼Œä¸”è®¾ç½®äº† xmn çš„æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä¸ç”¨è®¾ç½®ã€</li>
<li>-XX:SurvivorRatioï¼šEden åŒºå’Œ Survivor åŒºçš„å¤§å°æ¯”å€¼ï¼Œè®¾ç½®ä¸º 8ï¼Œåˆ™ä¸¤ä¸ª Survivor åŒºä¸ä¸€ä¸ª Eden åŒºçš„æ¯”å€¼ä¸º 2:8ï¼Œä¸€ä¸ª Survivor å æ•´ä¸ªæ–°ç”Ÿä»£çš„ 1/10</li>
<li>-XX:+HeapDumpOnOutOfMemoryErrorï¼šOOM æ—¶å¯¼å‡ºå †åˆ°æ–‡ä»¶</li>
<li>-XX:+HeapDumpPathï¼šå¯¼å‡º OOM çš„è·¯å¾„</li>
<li>-XX:OnOutOfMemoryErrorï¼šåœ¨ OOM æ—¶ï¼Œæ‰§è¡Œä¸€ä¸ªè„šæœ¬</li>
</ul>
<h4 id="java-æ ˆçš„å‚æ•°">Java æ ˆçš„å‚æ•°</h4>
<p>-Xssï¼šé€šå¸¸åªæœ‰å‡ ç™¾ Kï¼Œå†³å®šäº†å‡½æ•°è°ƒç”¨çš„æ·±åº¦</p>
<h4 id="å…ƒç©ºé—´çš„å‚æ•°">å…ƒç©ºé—´çš„å‚æ•°</h4>
<ul>
<li>-XX:MetaspaceSizeï¼šåˆå§‹ç©ºé—´å¤§å°</li>
<li>-XX:MaxMetaspaceSize: æœ€å¤§ç©ºé—´ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„</li>
<li>-XX:MinMetaspaceFreeRatioï¼šåœ¨ GC ä¹‹åï¼Œæœ€å°çš„ Metaspace å‰©ä½™ç©ºé—´å®¹é‡ç™¾åˆ†æ¯”</li>
<li>-XX:MaxMetaspaceFreeRatioï¼šåœ¨ GC ä¹‹åï¼Œæœ€å¤§çš„ Metaspace å‰©ä½™ç©ºé—´å®¹é‡ç™¾åˆ†æ¯”</li>
</ul>
<h2 id="å­—èŠ‚ç æ‰§è¡Œå¼•æ“">å­—èŠ‚ç æ‰§è¡Œå¼•æ“</h2>
<h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3>
<p>JVM çš„å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ŒåŠŸèƒ½åŸºæœ¬å°±æ˜¯è¾“å…¥å­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åå¯¹å­—èŠ‚ç è¿›è¡Œè§£æå¹¶å¤„ç†ï¼Œæœ€åè¾“å‡ºæ‰§è¡Œç»“æœ</p>
<p>å®ç°æ–¹å¼åŒèƒ½æœ‰é€šè¿‡è§£é‡Šå™¨ç›´æ¥è§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼Œæˆ–è€…æ˜¯é€šè¿‡å³æ—¶ç¼–è¯‘å™¨äº§ç”Ÿæœ¬åœ°ä»£ç ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘æ‰§è¡Œï¼Œå½“ç„¶ä¹Ÿå¯èƒ½ä¸¤è€…çš†æœ‰</p>
<h3 id="æ ˆå¸§-è¿è¡ŒæœŸæ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ä¹‹é—´çš„äº¤äº’å…³ç³»">æ ˆå¸§ã€è¿è¡ŒæœŸæ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ä¹‹é—´çš„äº¤äº’å…³ç³»</h3>
<h4 id="æ ˆå¸§æ¦‚è¿°">æ ˆå¸§æ¦‚è¿°</h4>
<p>æ ˆå¸§æ˜¯ç”¨äºæ”¯æŒ JVM è¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•æ‰§è¡Œçš„æ•°æ®ç»“æ„</p>
<p>æ ˆå¸§éšç€æ–¹æ³•è°ƒç”¨è€Œåˆ›å»ºï¼Œéšç€æ–¹æ³•ç»“æŸè€Œé”€æ¯</p>
<p>æ ˆå¸§é‡Œé¢å­˜å‚¨äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€ç­‰ä¿¡æ¯</p>
<h4 id="æ ˆå¸§æ¦‚å¿µç»“æ„">æ ˆå¸§æ¦‚å¿µç»“æ„</h4>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220115000957366.png" alt="image-20220115000957366" style="zoom:50%;" />
<h4 id="å±€éƒ¨å˜é‡è¡¨">å±€éƒ¨å˜é‡è¡¨</h4>
<p>ç”¨æ¥å­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡çš„å­˜å‚¨ç©ºé—´</p>
<ol>
<li>ä»¥å˜é‡æ§½ slot ä¸ºå•ä½ï¼Œç›®å‰ä¸€ä¸ª slot å­˜æ”¾ 32 ä½ä»¥å†…çš„æ•°æ®ç±»å‹</li>
<li>å¯¹äº 64 ä½çš„æ•°æ®å æ® 2 ä¸ª slot</li>
<li>å¯¹äºå®ä¾‹æ–¹æ³•ï¼Œç¬¬ 0 ä½ slot å­˜æ”¾çš„æ˜¯ thisï¼Œç„¶åä» 1 åˆ° nï¼Œä¾æ¬¡åˆ†é…ç»™å‚æ•°åˆ—è¡¨</li>
<li>æ ¹æ®æ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å˜é‡é¡ºåºå’Œä½œç”¨äºæ¥åˆ†é… slot</li>
<li>slot æ˜¯å¤ç”¨çš„ï¼Œä»¥èŠ‚çœæ ˆå¸§çš„ç©ºé—´ï¼Œè¿™ç§è®¾è®¡å¯èƒ½ä¼šå½±å“åˆ°ç³»ç»Ÿçš„åƒåœ¾æ”¶é›†è¡Œä¸º</li>
</ol>
<h4 id="æ“ä½œæ•°æ ˆ">æ“ä½œæ•°æ ˆ</h4>
<p>ç”¨æ¥å­˜æ”¾æ–¹æ³•è¿è¡ŒæœŸé—´ï¼Œå„ä¸ªæŒ‡ä»¤æ“ä½œçš„æ•°æ®</p>
<ol>
<li>æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»å’Œå­—èŠ‚ç æŒ‡ä»¤çš„é¡ºåºä¸¥æ ¼åŒ¹é…</li>
<li>è™šæ‹Ÿæœºåœ¨å®ç°æ ˆå¸§çš„æ—¶å€™å¯èƒ½ä¼šåšä¸€äº›ä¼˜åŒ–ï¼Œè®©ä¸¤ä¸ªæ ˆå¸§å‡ºç°éƒ¨åˆ†é‡å åŒºåŸŸï¼Œä»¥å­˜æ”¾å…±ç”¨çš„æ•°æ®</li>
</ol>
<h4 id="åŠ¨æ€è¿æ¥">åŠ¨æ€è¿æ¥</h4>
<p>æ¯ä¸ªæ ˆå¸§æŒæœ‰ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼Œä»¥æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹çš„åŠ¨æ€è¿æ¥</p>
<ol>
<li>é™æ€è§£æï¼šç±»åŠ è½½çš„æ—¶å€™ï¼Œç¬¦å·å¼•ç”¨å°±è½¬åŒ–æˆç›´æ¥å¼•ç”¨</li>
<li>åŠ¨æ€è¿æ¥ï¼šè¿è¡ŒæœŸé—´è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li>
</ol>
<h4 id="æ–¹æ³•è¿”å›åœ°å€">æ–¹æ³•è¿”å›åœ°å€</h4>
<p>æ–¹æ³•æ‰§è¡Œåè¿”å›çš„åœ°å€</p>
<h3 id="æ–¹æ³•è°ƒç”¨-é™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾">æ–¹æ³•è°ƒç”¨ã€é™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾</h3>
<h4 id="æ–¹æ³•è°ƒç”¨">æ–¹æ³•è°ƒç”¨</h4>
<p>æ–¹æ³•è°ƒç”¨å°±æ˜¯ç¡®å®šå…·ä½“è°ƒç”¨é‚£ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸æ¶‰åŠæ–¹æ³•å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹</p>
<ol>
<li>éƒ¨åˆ†æ–¹æ³•æ˜¯ç›´æ¥åœ¨ç±»åŠ è½½çš„é˜¶æ®µè§£æå°±ç¡®å®šäº†ç›´æ¥å¼•ç”¨å…³ç³»ã€Œé™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•ã€</li>
<li>ä½†æ˜¯å¯¹äºå®ä¾‹æ–¹æ³•ï¼Œä¹Ÿç§°è™šæ–¹æ³•ï¼Œå› ä¸ºé‡è½½å’Œå¤šæ€ï¼Œéœ€è¦è¿è¡ŒæœŸåŠ¨æ€å§”æ´¾</li>
</ol>
<h4 id="é™æ€åˆ†æ´¾">é™æ€åˆ†æ´¾</h4>
<p>æŒ‡æ‰€æœ‰ä¾èµ–é™æ€ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾æ–¹å¼ï¼Œæ¯”å¦‚é‡è½½æ–¹æ³•</p>
<h4 id="åŠ¨æ€åˆ†æ´¾">åŠ¨æ€åˆ†æ´¾</h4>
<p>æ ¹æ®è¿è¡ŒæœŸçš„å®é™…ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åŠ¨æ€åˆ†æ´¾æ–¹å¼ï¼Œæ¯”å¦‚æ¥å£çš„å®ç°æ–¹æ³•å’Œè¦†ç›–æ–¹æ³•</p>
<h4 id="å•åˆ†æ´¾å’Œå¤šåˆ†æ´¾">å•åˆ†æ´¾å’Œå¤šåˆ†æ´¾</h4>
<p>å°±æ˜¯æŒ‰ç…§åˆ†æ´¾æ€è€ƒçš„çº¬åº¦ï¼Œå¤šäºä¸€ä¸ªçš„å°±ç®—å¤šåˆ†æ´¾ï¼Œåªæœ‰ä¸€ä¸ªçš„ç§°ä¸ºå•åˆ†æ´¾</p>
<p>å¦‚ä½•æ‰§è¡Œæ–¹æ³•ä¸­çš„å­—èŠ‚ç æŒ‡ä»¤ï¼šJVM é€šè¿‡åŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œå¼•æ“æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼ŒJVM çš„æŒ‡ä»¤é›†ä¹Ÿæ˜¯åŸºäºæ ˆçš„</p>
<h2 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶</h2>
<h3 id="åƒåœ¾å›æ”¶åŸºç¡€">åƒåœ¾å›æ”¶åŸºç¡€</h3>
<h4 id="åƒåœ¾å›æ”¶æ¦‚è¿°">åƒåœ¾å›æ”¶æ¦‚è¿°</h4>
<p>ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šç®€å•è¯´å°±æ˜¯å†…å­˜ä¸­å·²ç»ä¸å†è¢«ä½¿ç”¨åˆ°çš„å†…å­˜ç©ºé—´å°±æ˜¯åƒåœ¾</p>
<p>å¦‚ä½•åˆ¤å®šæ˜¯å¦æ˜¯åƒåœ¾ï¼š</p>
<p>å¼•ç”¨è®¡æ•°æ³•ï¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæœ‰è®¿é—®å°±åŠ  1ï¼Œå¼•ç”¨å¤±æ•ˆå°±å‡ 1</p>
<p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ã€æ•ˆç‡é«˜;ç¼ºç‚¹ï¼šä¸èƒ½è§£å†³å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„é—®é¢˜</p>
<h4 id="æ ¹æœç´¢ç®—æ³•">æ ¹æœç´¢ç®—æ³•</h4>
<p>ä»è·Ÿï¼ˆGC Rootsï¼‰èŠ‚ç‚¹å‘ä¸‹æœç´¢å¯¹è±¡èŠ‚ç‚¹ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°æ ¹ä¹‹é—´æ²¡æœ‰è¿é€šçš„è¯ï¼Œåˆ™è¯¥å¯¹è±¡ä¸å¯ç”¨</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220116174454262.png" alt="image-20220116174454262" style="zoom:50%;" />
<p>å¯ä½œä¸º GC Roots çš„å¯¹è±¡åŒ…æ‹¬ï¼šè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§å±€éƒ¨å˜é‡ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€æ–¹æ³•åŒºç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡</p>
<p>HotSpot ä½¿ç”¨äº†ä¸€ç»„å«åš OopMap çš„æ•°æ®ç»“æ„è¾¾åˆ°å‡†ç¡®å¼ GC çš„ç›®çš„</p>
<p>åœ¨ OopMap çš„ååŠ©ä¸‹ï¼ŒJVM å¯ä»¥å¾ˆå¿«çš„åšå®Œ GC Roots æšä¸¾ã€‚ä½†æ˜¯ JVM å¹¶æ²¡æœ‰ä¸ºæ¯ä¸€æ¡æŒ‡ä»¤ç”Ÿæˆä¸€ä¸ª OopMap</p>
<p>è®°å½• OopMap çš„è¿™äº›ã€Œç‰¹å®šä½ç½®ã€è¢«ç§°ä¸ºå®‰å…¨ç‚¹ï¼Œå³å½“å‰çº¿ç¨‹æ‰§è¡Œåˆ°å®‰å…¨ç‚¹åæ‰å…è®¸æš‚åœè¿›è¡Œ GC</p>
<p>å¦‚æœä¸€æ®µä»£ç ä¸­ï¼Œå¯¹è±¡å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»ä½•åœ°æ–¹å¼€å§‹ GC éƒ½æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒºåŸŸç§°ä¸ºå®‰å…¨åŒºåŸŸ</p>
<h4 id="å¼•ç”¨åˆ†ç±»">å¼•ç”¨åˆ†ç±»</h4>
<ul>
<li>å¼ºå¼•ç”¨ï¼šç±»ä¼¼äº Object a = new A() è¿™æ ·çš„ï¼Œä¸ä¼šè¢«å›æ”¶</li>
<li>è½¯å¼•ç”¨ï¼šè¿˜æœ‰ç”¨ä½†å¹¶ä¸å¿…é¡»çš„å¯¹è±¡ã€‚ç”¨ SoftReference æ¥å®ç°è½¯å¼•ç”¨</li>
<li>å¼±å¼•ç”¨ï¼šéå¿…éœ€å¯¹è±¡ï¼Œæ¯”è½¯å¼•ç”¨è¿˜è¦å¼±ï¼Œåƒåœ¾å›æ—¶ä¼šå›æ”¶æ‰ã€‚ç”¨ WeakReference æ¥å®ç°å¼±å¼•ç”¨</li>
<li>è™šå¼•ç”¨ï¼šä¹Ÿæˆä¸ºå¹½çµå¼•ç”¨æˆ–å¹»å½±å¼•ç”¨ï¼Œæ˜¯æœ€å¼±çš„å¼•ç”¨ã€‚åƒåœ¾å›æ”¶æ—¶ä¼šå›æ”¶æ‰ã€‚ç”¨ PhantomReference æ¥å®ç°è™šå¼•ç”¨</li>
</ul>
<h4 id="è·¨ä»£å¼•ç”¨">è·¨ä»£å¼•ç”¨</h4>
<p>ä¸€ä¸ªä»£ä¸­çš„å¯¹è±¡å¼•ç”¨å¦ä¸€ä¸ªä»£ä¸­çš„å¯¹è±¡</p>
<p>è·¨ä»£å¼•ç”¨å‡è¯´ï¼šè·¨ä»£å¼•ç”¨ç›¸å¯¹äºåŒä»£å¼•ç”¨æ¥è¯´åªæ˜¯æå°‘æ•°</p>
<p>éšå«æ¨è®ºï¼šå­˜åœ¨äº’ç›¸å¼•ç”¨å…³ç³»çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œæ˜¯åº”è¯¥å€¾å‘äºåŒæ—¶ç”Ÿå­˜æˆ–è€…åŒæ—¶æ¶ˆäº¡çš„</p>
<h4 id="è®°å¿†é›†">è®°å¿†é›†</h4>
<p>è®°å¿†é›†ï¼ˆRemembered Setï¼‰ï¼šä¸€ç§ç”¨äºè®°å½•ä»éæ”¶é›†åŒºåŸŸæŒ‡å‘æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆé›†åˆçš„æŠ½è±¡æ•°æ®ç»“æ„</p>
<ul>
<li>å­—é•¿ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€ä¸ªæœºå™¨å­—é•¿ï¼Œè¯¥å­—åŒ…å«è·¨ä»£æŒ‡é’ˆ</li>
<li>å¯¹è±¡ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡é‡Œæœ‰å­—æ®µå«æœ‰è·¨ä»£æŒ‡é’ˆ</li>
<li>å¡ç²¾åº¦ï¼ˆä¸»è¦åœ¨ç”¨ï¼‰ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¯¥åŒºåŸŸå†…æœ‰å¯¹è±¡å«æœ‰è·¨ä»£æŒ‡é’ˆ
<ul>
<li>å¡è¡¨ï¼ˆCard Tableï¼‰ï¼šæ˜¯è®°å¿†é›†çš„ä¸€ç§å…·ä½“å®ç°ï¼Œå®šä¹‰äº†è®°å¿†é›†çš„è®°å½•ç²¾åº¦å’Œå †å†…å­˜çš„æ˜ å°„å…³ç³»ç­‰</li>
<li>å¡è¡¨çš„æ¯ä¸ªå…ƒç´ éƒ½å¯¹åº”ç€å…¶æ ‡è¯†çš„å†…å­˜åŒºåŸŸä¸­ä¸€å—ç‰¹å®šå¤§å°çš„å†…å­˜å—ï¼Œè¿™ä¸ªå†…å­˜å—ç§°ä¸ºå¡é¡µï¼ˆCard Pageï¼‰</li>
</ul>
</li>
</ul>
<h4 id="å†™å±éšœ">å†™å±éšœ</h4>
<p>å†™å±éšœå¯ä»¥çœ‹æˆæ˜¯ JVM å¯¹ã€Œå¼•ç”¨ç±»å‹å­—æ®µèµ‹å€¼ã€è¿™ä¸ªåŠ¨ä½œçš„ AOP</p>
<p>é€šè¿‡å†™å±éšœæ¥å®ç°å½“å¯¹è±¡çŠ¶æ€æ”¹å˜åï¼Œç»´æŠ¤å¡è¡¨çŠ¶æ€</p>
<h4 id="åˆ¤æ–­æ˜¯å¦åƒåœ¾çš„æ­¥éª¤">åˆ¤æ–­æ˜¯å¦åƒåœ¾çš„æ­¥éª¤</h4>
<ol>
<li>æ ¹æœç´¢ç®—æ³•åˆ¤æ–­ä¸å¯ç”¨</li>
<li>çœ‹æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•</li>
<li>1 å’Œ 2 æ­¥éª¤èµ°å®Œåå¯¹è±¡ä»ç„¶æ²¡æœ‰äººä½¿ç”¨ï¼Œé‚£å°±å±äºåƒåœ¾</li>
</ol>
<h4 id="gc-ç±»å‹">GC ç±»å‹</h4>
<ul>
<li>MinorGC / YoungGCï¼šå‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„æ”¶é›†åŠ¨ä½œ</li>
<li>MajorGC / OldGcï¼šå‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œç›®å‰åªæœ‰CMS æ”¶é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸º</li>
<li>MixedGCï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£ï¼Œç›®å‰åªæœ‰ G1 æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸º</li>
<li>FullGCï¼šæ”¶é›†è¿™ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„ GC</li>
</ul>
<h4 id="stop-the-world">Stop-The-World</h4>
<p>STW æ˜¯ Java ä¸­ä¸€ç§å…¨å±€æš‚åœç°è±¡ï¼Œå¤šåŠç”±äº GC å¼•èµ·ã€‚æ‰€è°“å…¨å±€åœé¡¿ï¼Œå°±æ˜¯æ‰€æœ‰ Java ä»£ç åœæ­¢è¿è¡Œï¼Œnative ä»£ç å¯ä»¥æ‰§è¡Œï¼Œä½†ä¸èƒ½å’Œ JVM äº¤äº’</p>
<p>å…¶å±é™©æ˜¯é•¿æ—¶é—´æœåŠ¡åœæ­¢ï¼Œæ²¡æœ‰å“åº”;å¯¹äº HA ç³»ç»Ÿï¼Œå¯èƒ½å¼•èµ·ä¸»å¤‡åˆ‡æ¢ï¼Œä¸¥é‡å±å®³ç”Ÿäº§ç¯å¢ƒ</p>
<h4 id="åƒåœ¾æ”¶é›†ç±»å‹">åƒåœ¾æ”¶é›†ç±»å‹</h4>
<ul>
<li>
<p>ä¸²è¡Œæ”¶é›†ï¼šGC å•çº¿ç¨‹å†…å­˜å›æ”¶ã€ä¼šæš‚åœæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹ï¼Œå¦‚ï¼šSerial</p>
</li>
<li>
<p>å¹¶è¡Œæ”¶é›†ï¼šå¤šä¸ª GC çº¿ç¨‹å¹¶å‘å·¥ä½œï¼Œæ­¤æ—¶ç”¨æˆ·çº¿ç¨‹æ˜¯æš‚åœçš„ï¼Œå¦‚ï¼šParallel</p>
</li>
<li>
<p>å¹¶å‘æ”¶é›†ï¼šç”¨æˆ·çº¿ç¨‹å’Œ GC çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œå¯èƒ½äº¤æ›¿æ‰§è¡Œï¼‰ï¼Œä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¦‚ï¼šCMS</p>
</li>
</ul>
<h4 id="åˆ¤æ–­ç±»æ— ç”¨çš„æ¡ä»¶">åˆ¤æ–­ç±»æ— ç”¨çš„æ¡ä»¶</h4>
<ul>
<li>JVM ä¸­è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶</li>
<li>åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶</li>
<li>æ²¡æœ‰ä»»ä½•åœ°æ–¹å¼•ç”¨è¯¥ç±»çš„ Class å¯¹è±¡</li>
<li>æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¿™ä¸ªç±»</li>
</ul>
<h3 id="åƒåœ¾å›æ”¶ç®—æ³•">åƒåœ¾å›æ”¶ç®—æ³•</h3>
<h4 id="æ ‡è®°æ¸…é™¤æ³•">æ ‡è®°æ¸…é™¤æ³•</h4>
<p>æ ‡è®°æ¸…é™¤æ³•ï¼ˆMark-Sweepï¼‰ç®—æ³•åˆ†æˆæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µï¼Œå…ˆæ ‡è®°å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åç»Ÿä¸€å›æ”¶è¿™äº›å¯¹è±¡</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220116232544743.png" alt="image-20220116232544743" style="zoom:25%;" />
<p>ä¼˜ç‚¹æ˜¯ç®€å•</p>
<p>ç¼ºç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ•ˆç‡ä¸é«˜ï¼Œæ ‡è®°å’Œæ¸…é™¤çš„æ•ˆç‡éƒ½ä¸é«˜</li>
<li>æ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œä»è€Œå¯¼è‡´åœ¨åˆ†é…å¤§å¯¹è±¡æ—¶è§¦å‘ GC</li>
</ul>
<h4 id="å¤åˆ¶ç®—æ³•">å¤åˆ¶ç®—æ³•</h4>
<p>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ï¼šæŠŠå†…å­˜åˆ†æˆä¸¤å—å®Œå…¨ç›¸åŒçš„åŒºåŸŸï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“ä¸€å—ä½¿ç”¨å®Œäº†ï¼Œå°±æŠŠè¿™å—ä¸Šè¿˜å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°å¦å¤–ä¸€å—ï¼Œç„¶åæŠŠè¿™å—æ¸…é™¤æ‰</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220116233216995.png" alt="image-20220116233216995" style="zoom:25%;" />
<p>ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆï¼Œä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡çš„é—®é¢˜</p>
<p>ç¼ºç‚¹æ˜¯å†…å­˜æœ‰äº›æµªè´¹</p>
<p>JVM å®é™…å®ç°ä¸­ï¼Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden åŒºå’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œä¸€å— Survivorï¼Œå›æ”¶æ—¶ï¼ŒæŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å— Survivor</p>
<p>HotSpot é»˜è®¤çš„ Eden å’Œ Survivor æ¯”ä¾‹æ˜¯ 8:1ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡èƒ½ç”¨ 90%çš„æ–°ç”Ÿä»£ç©ºé—´</p>
<p>å¦‚æœ Survivor ç©ºé—´ä¸å¤Ÿï¼Œå°±è¦ä¾èµ–è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ŒæŠŠæ”¾ä¸ä¸‹çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</p>
<h5 id="åˆ†é…æ‹…ä¿">åˆ†é…æ‹…ä¿</h5>
<p>åˆ†é…æ‹…ä¿æ˜¯ï¼šå½“æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾å›æ”¶åï¼Œæ–°ç”Ÿä»£çš„å­˜æ´»åŒºæ”¾ç½®ä¸ä¸‹ï¼Œé‚£ä¹ˆéœ€è¦æŠŠè¿™äº›å¯¹è±¡æ”¾ç½®åˆ°è€å¹´ä»£å»çš„ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è€å¹´ä»£ä¸ºæ–°ç”Ÿä»£çš„ GC åšç©ºé—´åˆ†é…æ‹…ä¿ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨å‘ç”Ÿ MinorGC å‰ï¼ŒJVM ä¼šæ£€æŸ¥è€å¹´ä»£çš„æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´ï¼Œæ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ï¼Œå¦‚æœå¤§äºï¼Œå¯ä»¥ç¡®ä¿ MinorGC æ˜¯å®‰å…¨çš„</li>
<li>å¦‚æœå°äºï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸ï¼Œåˆ™ç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´ï¼Œæ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°</li>
<li>å¦‚æœå¤§äºï¼Œåˆ™å°è¯•è¿›è¡Œä¸€æ¬¡ MinorGC</li>
<li>å¦‚æœå°äºï¼Œåˆ™æ”¹ä¸ºåšä¸€æ¬¡ FUllGC</li>
</ol>
<h4 id="æ ‡è®°æ•´ç†æ³•">æ ‡è®°æ•´ç†æ³•</h4>
<p>æ ‡è®°æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰ï¼šç”±äºå¤åˆ¶ç®—æ³•åœ¨å­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ•ˆç‡è¾ƒä½ï¼Œä¸”æœ‰ç©ºé—´æµªè´¹ï¼Œå› æ­¤è€å¹´ä»£ä¸€èˆ¬ä¸ä¼šé€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£å¤šé€‰ç”¨æ ‡è®°æ•´ç†ç®—æ³•</p>
<p>æ ‡è®°è¿‡ç¨‹æ ¹æ ‡è®°æ¸…é™¤æ³•çš„æ ‡è®°ä¸€æ ·ï¼Œä½†åç»­ä¸æ˜¯ç›´æ¥æ¸…é™¤å¯å›æ”¶å¯¹è±¡ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…é™¤è¾¹ç•Œä»¥å¤–çš„å†…å­˜</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220116235040046.png" alt="image-20220116235040046" style="zoom:40%;" />
<h3 id="åƒåœ¾æ”¶é›†å™¨">åƒåœ¾æ”¶é›†å™¨</h3>
<p>å‰é¢è®¨è®ºçš„åƒåœ¾æ”¶é›†ç®—æ³•åªæ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ˜¯æ¥å…·ä½“å®ç°è¿™äº›ç®—æ³•å¹¶å®ç°å†…å­˜å›æ”¶</p>
<p>ä¸åŒå‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºå®ç°å·®åˆ«å¾ˆå¤§ï¼ŒHotSpot ä¸­åŒ…å«çš„æ”¶é›†å™¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220117000722672.png" alt="image-20220117000722672" style="zoom:80%;" />
<h4 id="ä¸²è¡Œæ”¶é›†å™¨">ä¸²è¡Œæ”¶é›†å™¨</h4>
<p>Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨/Serial Old æ”¶é›†å™¨ï¼Œæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œåœ¨åƒåœ¾æ”¶é›†æ—¶ï¼Œä¼š Stop-the-World</p>
<p>Serial/Serial Old æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220117000825597.png" alt="image-20220117000825597" style="zoom:50%;" />
<p>ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œå¯¹äºå• cpuï¼Œç”±äºæ²¡æœ‰å¤šçº¿ç¨‹çš„äº¤äº’å¼€é”€ï¼Œå¯èƒ½æ›´é«˜æ•ˆï¼Œæ˜¯é»˜è®¤çš„ Client æ¨¡å¼ä¸‹çš„æ–°ç”Ÿä»£æ”¶é›†å™¨</p>
<p>ä½¿ç”¨-XX:+UseSerialGC æ¥å¼€å¯ï¼Œä¼šä½¿ç”¨ï¼šSerial + Serial Old çš„æ”¶é›†å™¨ç»„åˆ</p>
<p>æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</p>
<h4 id="å¹¶è¡Œæ”¶é›†å™¨">å¹¶è¡Œæ”¶é›†å™¨</h4>
<p>ParNewï¼ˆå¹¶è¡Œï¼‰æ”¶é›†å™¨ï¼šä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œåœ¨åƒåœ¾æ”¶é›†æ—¶ï¼Œä¼š Stop-the-World</p>
<p>å¹¶è¡Œæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p>
 <img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118163834807.png" alt="image-20220118163834807" style="zoom:67%;" />
<p>åœ¨å¹¶å‘èƒ½åŠ›å¥½çš„ CPU ç¯å¢ƒé‡Œï¼Œå®ƒåœé¡¿çš„æ—¶é—´è¦æ¯”ä¸²è¡Œæ”¶é›†å™¨çŸ­;ä½†å¯¹äºå• CPU æˆ–å¹¶å‘èƒ½åŠ›è¾ƒå¼±çš„ CPUï¼Œç”±äºå¤šçº¿ç¨‹çš„äº¤äº’å¼€é”€ï¼Œå¯èƒ½æ¯”ä¸²è¡Œæ”¶é›†å™¨æ›´å·®</p>
<p>æ˜¯ Server æ¨¡å¼ä¸‹é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¸”èƒ½å’Œ CMS æ”¶é›†å™¨é…åˆä½¿ç”¨</p>
<p>ä¸å†ä½¿ç”¨-XX:+UseParNewGC æ¥å•ç‹¬å¼€å¯</p>
<p>-XX:ParallelGCTHreadsï¼šæŒ‡å®šçº¿ç¨‹æ•°ï¼Œæœ€å¥½ä¸ CPU æ•°é‡ä¸€è‡´</p>
<p>æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•</p>
<h4 id="æ–°ç”Ÿä»£-parallel-scavenge-æ”¶é›†å™¨">æ–°ç”Ÿä»£ Parallel Scavenge æ”¶é›†å™¨</h4>
<p>æ–°ç”Ÿä»£ Parallel Scavenge æ”¶é›†å™¨ï¼šæ˜¯ä¸€ä¸ªåº”ç”¨äºæ–°ç”Ÿä»£çš„ã€ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„ã€å¹¶è¡Œçš„æ”¶é›†å™¨</p>
<p>è·Ÿ ParNew å¾ˆç±»ä¼¼ï¼Œå•æ›´å…³æ³¨ååé‡ï¼Œèƒ½æœ€é«˜æ•ˆç‡çš„åˆ©ç”¨ CPUï¼Œé€‚åˆè¿è¡Œåå°åº”ç”¨</p>
<p>Parallel Scavenge / Parallel Old æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118170105022.png" alt="image-20220118170105022" style="zoom:50%;" />
<p>ä½¿ç”¨ -XX:+UseParallelGC æ¥å¼€å¯</p>
<p>ä½¿ç”¨ -XX:UseParallelOldGC æ¥å¼€å¯è€å¹´ä»£ä½¿ç”¨ Parallel Old æ”¶é›†å™¨ï¼Œä½¿ç”¨ Parallel Scavenge + Parallel Old çš„æ”¶é›†å™¨ç»„åˆ</p>
<p>-XX:MaxGCPauseMillisï¼šè®¾ç½® GC çš„æœ€å¤§åœé¡¿æ—¶é—´</p>
<p>æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•</p>
<h4 id="cms-æ”¶é›†å™¨">CMS æ”¶é›†å™¨</h4>
<p>CMSï¼ˆConcurrent Mark and Sweep å¹¶å‘æ ‡è®°æ¸…é™¤ï¼‰ï¼Œè¿™é‡Œçš„å¹¶å‘æŒ‡çš„æ˜¯ GC çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶åœ¨è¿è¡Œï¼Œæ”¶é›†å™¨åˆ†ä¸ºï¼š</p>
<ul>
<li>åˆå§‹æ ‡è®°ï¼šåªæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡</li>
<li>å¹¶å‘æ ‡è®°ï¼šè¿›è¡Œ GC Roots Tracing çš„è¿‡ç¨‹</li>
<li>é‡æ–°æ ‡è®°ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç¨‹åºè¿è¡Œå¯¼è‡´æ ‡è®°å‘ç”Ÿå˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡</li>
<li>å¹¶å‘æ¸…é™¤ï¼šå¹¶å‘å›æ”¶åƒåœ¾å¯¹è±¡</li>
</ul>
<p>CMS æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118172542839.png" alt="image-20220118172542839" style="zoom:50%;" />
<p>åœ¨åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°ä¸¤ä¸ªé˜¶æ®µä¼šå‘ç”Ÿ Stop-the-World</p>
<p>ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œå¤šçº¿ç¨‹å¹¶å‘æ”¶é›†çš„åƒåœ¾æ”¶é›†å™¨</p>
<p>æœ€åçš„é‡ç½®çº¿ç¨‹ï¼ŒæŒ‡çš„æ˜¯æ¸…ç©ºè·Ÿæ”¶é›†å™¨ç›¸å…³çš„æ•°æ®å¹¶é‡ç½®ï¼Œä¸ºä¸‹ä¸€æ¬¡æ”¶é›†åšå‡†å¤‡</p>
<p>ä¼˜ç‚¹ï¼šä½åœé¡¿ã€å¹¶å‘æ‰§è¡Œ</p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¹¶å‘æ‰§è¡Œï¼Œå¯¹ CPU èµ„æºå‹åŠ›å¤§</li>
<li>æ— æ³•å¤„ç†ã€Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­ã€äº§ç”Ÿçš„åƒåœ¾ï¼Œå¯èƒ½å¯¼è‡´ FullGC</li>
<li>é‡‡ç”¨çš„æ ‡è®°æ¸…é™¤ç®—æ³•ä¼šå¯¼è‡´å¤§é‡ç¢ç‰‡ï¼Œä»è€Œåœ¨åˆ†é…å¤§å¯¹è±¡æ—¶å¯èƒ½è§¦å‘ FullGC</li>
</ul>
<p>å¼€å¯ï¼š-XX:UseConcMarkSweepGCï¼šä½¿ç”¨ParNew + CMS + Serial Old çš„æ”¶é›†å™¨ç»„åˆï¼ŒSerial Old å°†ä½œä¸º CMS å‡ºé”™çš„åå¤‡æ”¶é›†å™¨</p>
<p>-XX:CMSInitiatingOccupancyFractionï¼šè®¾ç½® CMS æ”¶é›†å™¨åœ¨è€å¹´ä»£ç©ºé—´è¢«ä½¿ç”¨å¤šå°‘åè§¦å‘å›æ”¶ï¼Œé»˜è®¤ 80%ã€‚</p>
<h4 id="g1-æ”¶é›†å™¨">G1 æ”¶é›†å™¨</h4>
<p>G1ï¼ˆGarbage-Firstï¼‰æ”¶é›†å™¨ï¼šæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„æ”¶é›†å™¨ï¼Œä¸å…¶å®ƒæ”¶é›†å™¨ç›¸æ¯”ï¼Œå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>G1 æŠŠå†…å­˜åˆ’åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„åŒºåŸŸï¼ˆRegionï¼‰</li>
<li>G1 ä»é‡‡ç”¨åˆ†ä»£æ€æƒ³ï¼Œä¿ç•™äº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œä½†å®ƒä»¬ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œè€Œæ˜¯ä¸€éƒ¨åˆ† Region çš„é›†åˆï¼Œä¸”ä¸éœ€è¦ Region æ˜¯è¿ç»­çš„</li>
<li>G1 èƒ½å……åˆ†åˆ©ç”¨å¤š CPUã€å¤šæ ¸ç¯å¢ƒç¡¬ä»¶ä¼˜åŠ¿ï¼Œå°½é‡ç¼©çŸ­ STW</li>
<li>G1 æ•´ä½“ä¸Šé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œå±€éƒ¨æ˜¯é€šè¿‡å¤åˆ¶ç®—æ³•ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</li>
<li>G1 çš„åœé¡¿å¯é¢„æµ‹ï¼Œèƒ½æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸èƒ½è¶…è¿‡æŒ‡å®šæ—¶é—´</li>
<li>G1 è·Ÿè¸ªå„ä¸ª Region é‡Œé¢åƒåœ¾å †çš„ä»·å€¼å¤§å°ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ—¶é—´æ¥å›æ”¶ä»·å€¼æœ€å¤§çš„åŒºåŸŸï¼Œä»è€Œä¿è¯åœ¨æœ‰é™æ—¶é—´å†…çš„é«˜æ•ˆæ”¶é›†,ä»·å€¼å¤§å°çš„åˆ¤å®šï¼šåœ¨æœ‰é™çš„æ—¶é—´å†…èƒ½å›æ”¶æœ€å¤šçš„åŒºåŸŸä»·å€¼å¤§</li>
</ul>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118174352339.png" alt="image-20220118174352339" style="zoom:50%;" />
<p>è·Ÿ CMS ç±»ä¼¼ï¼Œåˆ†ä¸ºå››ä¸ªä¸»è¦é˜¶æ®µï¼š</p>
<ol>
<li>åˆå§‹æ ‡è®°ï¼šåªæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡</li>
<li>å¹¶å‘æ ‡è®°ï¼šè¿›è¡Œ GC Roots Tracing çš„è¿‡ç¨‹</li>
<li>æœ€ç»ˆæ ‡è®°ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç¨‹åºè¿è¡Œå¯¼è‡´æ ‡è®°å‘ç”Ÿå˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡</li>
<li>ç­›é€‰å›æ”¶ï¼šæ ¹æ®æ—¶é—´æ¥è¿›è¡Œä»·å€¼æœ€å¤§åŒ–çš„å›æ”¶</li>
</ol>
<p>G1 æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p>
<img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20220118175539922.png" alt="image-20220118175539922" style="zoom:50%;" />
<h5 id="ä½¿ç”¨å’Œé…ç½®-g1">ä½¿ç”¨å’Œé…ç½® G1</h5>
<p>-XX:UseG1GCï¼šå¼€å¯ G1ï¼Œé»˜è®¤å°±æ˜¯ G1ã€‚</p>
<p>-XX:MaxGCPauseMillis=nï¼šæœ€å¤§GC åœé¡¿æ—¶é—´ï¼Œè¿™ä¸ªæ˜¯è½¯ç›®æ ‡ï¼ŒJVM å°†å°½å¯èƒ½ï¼ˆä½†ä¸ä¿è¯ï¼‰åœé¡¿å°äºè¿™ä¸ªæ—¶é—´ã€‚</p>
<p>-XX:InitiatingHeapOccupancyPercent=nï¼šå †å ç”¨äº†æŒ‡å®šç™¾åˆ†æ¯”çš„æ—¶å€™å°±è§¦å‘ GCï¼Œé»˜è®¤ä¸º 45ã€‚</p>
<p>-XX:NewRatio=nï¼šé»˜è®¤ä¸º 2ã€‚</p>
<p>-XX:SurivorRatio=nï¼šé»˜è®¤ä¸º 8ã€‚</p>
<p>-XX:MaxTenuringThreshold=nï¼šæ–°ç”Ÿä»£åˆ°è€å¹´ä»£çš„å²æ•°ï¼ŒæŒ‡çš„æ˜¯åœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº†å¤šå°‘æ¬¡çš„åƒåœ¾å›æ”¶éƒ½è¿˜å­˜æ´»ï¼Œè¾¾åˆ°æŒ‡å®šæ¬¡æ•°è¿›å…¥è€å¹´ä»£ï¼ŒGCé»˜è®¤ 15ã€‚</p>
<p>-XX:ParallelGCThreads=nï¼šå¹¶è¡Œ GC çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¼šæ ¹æ®å¹³å°ä¸åŒè€Œä¸åŒã€‚</p>
<p>-XX:ConcGCThreads=nï¼šå¹¶å‘ GC ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚</p>
<p>-XX:G1ReservePercent=nï¼šè®¾ç½®ä½œä¸ºç©ºé—²ç©ºé—´çš„é¢„ç•™å†…å­˜ç™¾åˆ†æ¯”ï¼Œä»¥é™ä½ç›®æ ‡ç©ºé—´æº¢å‡ºçš„é£é™©ï¼Œé»˜è®¤æ•° 10%ã€‚</p>
<p>-XX:G1HeapRegionSize=nï¼šè®¾ç½®çš„ G1 åŒºåŸŸçš„å¤§å°ã€‚å€¼æ˜¯ 2 çš„å¹‚ï¼ŒèŒƒå›´æ˜¯ 1MB åˆ° 32MBã€‚ç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„ Java å †å¤§å°åˆ’åˆ†å‡ºçº¦ 2048 ä¸ªåŒºåŸŸã€‚</p>
<h4 id="zgc-æ”¶é›†å™¨">ZGC æ”¶é›†å™¨</h4>
<p>ZGC æ”¶é›†å™¨ï¼ˆZ Garbage Collectorï¼‰ï¼šJDK11 åŠ å…¥çš„ä½å»¶è¿Ÿæ”¶é›†å™¨ã€‚</p>
<p>ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š</p>
<ol>
<li>æ”¯æŒ TB çº§å†…å­˜å®¹é‡</li>
<li>æš‚åœæ—¶é—´ä½ï¼ˆ&lt;10msï¼‰</li>
<li>å¯¹æ•´ä¸ªç¨‹åºååé‡çš„å½±å“å°äº 15%</li>
</ol>
<p>ZGC å…³é”®æŠ€æœ¯ï¼šç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœ</p>
<h5 id="ç€è‰²æŒ‡é’ˆ">ç€è‰²æŒ‡é’ˆ</h5>
<blockquote>
<p>ç€è‰²æŒ‡é’ˆæ˜¯ä¸€ç§å°†ä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­çš„æŠ€æœ¯ã€‚</p>
</blockquote>
<h5 id="è¯»å±éšœ">è¯»å±éšœ</h5>
<blockquote>
<p>è¯»å±éšœæ˜¯JVMå‘åº”ç”¨ä»£ç æ’å…¥ä¸€å°æ®µä»£ç çš„æŠ€æœ¯ã€‚å½“åº”ç”¨çº¿ç¨‹ä»å †ä¸­è¯»å–å¯¹è±¡å¼•ç”¨æ—¶ï¼Œå°±ä¼šæ‰§è¡Œè¿™æ®µä»£ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ã€Œä»å †ä¸­è¯»å–å¯¹è±¡å¼•ç”¨ã€æ‰ä¼šè§¦å‘è¿™æ®µä»£ç ã€‚</p>
</blockquote>
<p>ZGCä¸­è¯»å±éšœçš„ä»£ç ä½œç”¨ï¼šåœ¨å¯¹è±¡æ ‡è®°å’Œè½¬ç§»è¿‡ç¨‹ä¸­ï¼Œç”¨äºç¡®å®šå¯¹è±¡çš„å¼•ç”¨åœ°å€æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œå¹¶ä½œå‡ºç›¸åº”åŠ¨ä½œã€‚</p>
<h3 id="gc-æ€§èƒ½æŒ‡æ ‡">GC æ€§èƒ½æŒ‡æ ‡</h3>
<ul>
<li>ååé‡ = åº”ç”¨ä»£ç æ‰§è¡Œçš„æ—¶é—´/è¿è¡Œçš„æ€»æ—¶é—´ã€‚</li>
<li>GC è´Ÿè·ï¼Œä¸ååé‡ç›¸åï¼Œæ˜¯ GC æ—¶é—´/è¿è¡Œçš„æ€»æ—¶é—´ã€‚</li>
<li>æš‚åœæ—¶é—´ï¼Œå°±æ˜¯å‘ç”Ÿ Stop-The-World çš„æ€»æ—¶é—´ã€‚</li>
<li>GC é¢‘ç‡ï¼Œå°±æ˜¯ GCåœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…å‘ç”Ÿçš„æ¬¡æ•°ã€‚</li>
<li>ååº”é€Ÿåº¦ï¼Œå°±æ˜¯ä»å¯¹è±¡æˆä¸ºåƒåœ¾åˆ°è¢«å›æ”¶çš„æ—¶é—´ã€‚</li>
<li>äº¤äº’å¼åº”ç”¨é€šå¸¸å¸Œæœ›æš‚åœæ—¶é—´è¶Šå°‘è¶Šå¥½ã€‚</li>
</ul>
<h3 id="jvm-å†…å­˜é…ç½®åŸåˆ™">JVM å†…å­˜é…ç½®åŸåˆ™</h3>
<ul>
<li>æ–°ç”Ÿä»£å°½å¯èƒ½è®¾ç½®å¤§ç‚¹ï¼Œå¦‚æœå¤ªå°ä¼šå¯¼è‡´ï¼š
<ul>
<li>YGC æ¬¡æ•°æ›´åŠ é¢‘ç¹ã€‚</li>
<li>å¯èƒ½å¯¼è‡´ YGC åçš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œå¦‚æœæ­¤æ—¶è€å¹´ä»£æ»¡äº†ï¼Œä¼šè§¦å‘ FGCã€‚</li>
</ul>
</li>
<li>å¯¹è€å¹´ä»£ï¼Œé’ˆå¯¹å“åº”æ—¶é—´ä¼˜å…ˆçš„åº”ç”¨ï¼šç”±äºè€å¹´ä»£é€šå¸¸é‡‡ç”¨å¹¶å‘æ”¶é›†å™¨ï¼Œå› æ­¤å…¶å¤§å°è¦ç»¼åˆè€ƒè™‘å¹¶å‘é‡å’Œå¹¶å‘æŒç»­æ—¶é—´ç­‰å‚æ•°ã€‚
<ul>
<li>å¦‚æœè®¾ç½®å°äº†ï¼Œå¯èƒ½ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œé«˜å›æ”¶é¢‘ç‡ä¼šå¯¼è‡´åº”ç”¨æš‚åœã€‚</li>
<li>å¦‚æœè®¾ç½®å¤§äº†ï¼Œä¼šéœ€è¦è¾ƒé•¿çš„å›æ”¶æ—¶é—´ã€‚</li>
</ul>
</li>
<li>å¯¹è€å¹´ä»£ï¼Œé’ˆå¯¹ååé‡ä¼˜å…ˆçš„åº”ç”¨ï¼šé€šå¸¸è®¾ç½®è¾ƒå¤§çš„æ–°ç”Ÿä»£å’Œè¾ƒå°çš„è€å¹´ä»£ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½å›æ”¶å¤§éƒ¨åˆ†çŸ­æœŸå¯¹è±¡ï¼Œå‡å°‘ä¸­æœŸå¯¹è±¡ï¼Œè€Œè€å¹´ä»£å°½é‡å­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ã€‚</li>
<li>ä¾æ®å¯¹è±¡çš„å­˜æ´»å‘¨æœŸè¿›è¡Œåˆ†ç±»ï¼Œå¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£åˆ†é…ï¼Œé•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚</li>
<li>æ ¹æ®ä¸åŒä»£çš„ç‰¹ç‚¹ï¼Œé€‰å–åˆé€‚çš„æ”¶é›†ç®—æ³•ï¼šå°‘é‡å¯¹è±¡å­˜æ´»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•;å¤§é‡å¯¹è±¡å­˜æ´»ï¼Œé€‚åˆæ ‡è®°æ¸…é™¤æˆ–è€…æ ‡è®°æ•´ç†ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker éƒ¨ç½² Spring Boot é¡¹ç›®]]></title>
        <id>https://sgaxun.github.io/post/docker-spring-boot/</id>
        <link href="https://sgaxun.github.io/post/docker-spring-boot/">
        </link>
        <updated>2020-08-25T14:25:25.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æ‰‹å·¥æ–¹å¼">æ‰‹å·¥æ–¹å¼</h2>
<h3 id="å‡†å¤‡">å‡†å¤‡</h3>
<p>åˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ã€Œweb-1.0-SNAPSHOT.jarã€ï¼Œæ‰“åŒ… jar åŒ…ã€‚</p>
<h3 id="ç¼–å†™-dockerfile">ç¼–å†™ Dockerfile</h3>
<pre><code class="language-shell">FROM java:8
VOLUME /tmp
ADD web-1.0-SNAPSHOT.jar web.jar
EXPOSE 8080
ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/web.jar&quot;]
</code></pre>
<blockquote>
<p>FROMï¼šè¡¨ç¤ºåŸºç¡€é•œåƒï¼Œè¿è¡Œç¯å¢ƒ</p>
<p>VOLUMEï¼šæ•°æ®å·</p>
<p>ADDï¼šjar åŒ…å¤åˆ¶åˆ°/web.jar</p>
<p>EXPOSE: æš´éœ²ç«¯å£</p>
<p>ENTRYPOINTï¼šå®¹å™¨è¿è¡Œæ—¶çš„å‘½ä»¤ï¼Œä¸ºäº†ç¼©çŸ­ Tomcat çš„å¯åŠ¨æ—¶é—´ï¼Œæ·»åŠ  java.security.egd çš„ç³»ç»Ÿå±æ€§æŒ‡å‘/dev/urandomä½œä¸º ENTRYPOINT</p>
</blockquote>
<h3 id="æ„å»ºå®¹å™¨">æ„å»ºå®¹å™¨</h3>
<pre><code class="language-shell">docker build -t web .
</code></pre>
<h3 id="è¿è¡Œå®¹å™¨">è¿è¡Œå®¹å™¨</h3>
<pre><code class="language-shell">docker run -di --name å®¹å™¨åç§° -p 8080:8080 é•œåƒåç§°
</code></pre>
<h3 id="æŸ¥çœ‹è¿è¡Œæ—¥å¿—">æŸ¥çœ‹è¿è¡Œæ—¥å¿—</h3>
<pre><code class="language-shell">docker logs -f --tail=100 å®¹å™¨åç§°
</code></pre>
<h3 id="è®¿é—®æµ‹è¯•">è®¿é—®æµ‹è¯•</h3>
<p>ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://ip:8080 æµ‹è¯•ç»“æœ</p>
<h2 id="ä½¿ç”¨-idea">ä½¿ç”¨ IDEA</h2>
<h3 id="é…ç½®-docker-è¿œç¨‹è¿æ¥ç«¯å£">é…ç½® Docker è¿œç¨‹è¿æ¥ç«¯å£</h3>
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p>
<pre><code class="language-shell">vi /usr/lib/systemd/system/docker.service
</code></pre>
<p>ä¿®æ”¹ä»¥ExecStartå¼€å¤´çš„è¡Œï¼ˆcentos 7ï¼‰ï¼šæ·»åŠ </p>
<pre><code class="language-shell">-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock \
</code></pre>
<p>é‡å¯ Docker</p>
<pre><code class="language-shell">systemctl daemon-reload
service docker restart
</code></pre>
<p>é‡å¯ä¹‹åæµ‹è¯•è¿œç¨‹è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œè¿™é‡Œçš„2375æ˜¯ä¹‹å‰é…ç½®çš„ç«¯å£</p>
<pre><code class="language-shell">curl http://localhost:2375/version
</code></pre>
<p>çœ‹åˆ°å›æ˜¾åŸºæœ¬ä¸Šå°±æ²¡é—®é¢˜äº†ã€‚</p>
<p>ç„¶åå¼€å¯ç«¯å£ï¼Œæˆ–è€…å…³é—­é˜²ç«å¢™ï¼ŒäºŒè€…é€‰å…¶ä¸€å³å¯</p>
<pre><code class="language-shell"># å¼€æ”¾ç«¯å£
firewall-cmd --zone=public --add-port=2375/tcp --permanent
# å…³é—­é˜²ç«å¢™
chkconfig iptables off
</code></pre>
<h3 id="ä½¿ç”¨-idea-è¿æ¥-docker">ä½¿ç”¨ IDEA è¿æ¥ Docker</h3>
<p>IDEA è‡ªå¸¦äº† Docker æ’ä»¶ï¼Œå¦‚æœæ²¡æœ‰å»æ’ä»¶ä¸­å¿ƒä¸‹è½½</p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20211225231522317.png" alt="image-20211225231522317" loading="lazy"></figure>
<p>ç„¶åé…ç½® Docker åœ°å€ï¼Œå®Œæˆè¿æ¥åä¼šåˆ—å‡ºå®¹å™¨å’Œé•œåƒã€‚ç„¶åé…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/sgaxun/image-hosting/main/img/image-20211225232025926.png" alt="image-20211225232025926" loading="lazy"></figure>
<h3 id="docker-maven-plugin">docker-maven-plugin</h3>
<p>é¡¹ç›®å·¥ç¨‹ä¸€èˆ¬ä½¿ç”¨ Maven ç¼–è¯‘æ‰“åŒ…ï¼Œç„¶åç”Ÿæˆé•œåƒï¼Œé€šè¿‡é•œåƒä¸Šçº¿ï¼Œèƒ½å¤Ÿå¤§å¤§æä¾›ä¸Šçº¿æ•ˆç‡ï¼ŒåŒæ—¶èƒ½å¤Ÿå¿«é€ŸåŠ¨æ€æ‰©å®¹ï¼Œå¿«é€Ÿå›æ»šï¼Œç€å®å¾ˆæ–¹ä¾¿ã€‚docker-maven-plugin æ’ä»¶å°±æ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ä»¬åœ¨Mavenå·¥ç¨‹ä¸­ï¼Œé€šè¿‡ç®€å•çš„é…ç½®ï¼Œè‡ªåŠ¨ç”Ÿæˆé•œåƒå¹¶æ¨é€åˆ°ä»“åº“ä¸­ã€‚</p>
<pre><code class="language-xml">&lt;build&gt;

        &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;

        &lt;plugins&gt;

            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;fork&gt;true&lt;/fork&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;!-- è·³è¿‡å•å…ƒæµ‹è¯• --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;skipTests&gt;true&lt;/skipTests&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;

            &lt;!--ä½¿ç”¨docker-maven-pluginæ’ä»¶--&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.0.0&lt;/version&gt;
                &lt;!--å°†æ’ä»¶ç»‘å®šåœ¨æŸä¸ªphaseæ‰§è¡Œ--&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;build-image&lt;/id&gt;
                        &lt;!--ç”¨æˆ·åªéœ€æ‰§è¡Œmvn package ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œmvn docker:build--&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;build&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;configuration&gt;
                    &lt;!--æŒ‡å®šç”Ÿæˆçš„é•œåƒå--&gt;
                    &lt;imageName&gt;bruceliu/${project.artifactId}&lt;/imageName&gt;
                    &lt;!--æŒ‡å®šæ ‡ç­¾--&gt;
                    &lt;imageTags&gt;
                        &lt;imageTag&gt;latest&lt;/imageTag&gt;
                    &lt;/imageTags&gt;
                    &lt;!--æŒ‡å®šåŸºç¡€é•œåƒjdk1.8--&gt;
                    &lt;baseImage&gt;java&lt;/baseImage&gt;
                    &lt;!--é•œåƒåˆ¶ä½œäººæœ¬äººä¿¡æ¯--&gt;
                    &lt;maintainer&gt;bruceliu@email.com&lt;/maintainer&gt;
                    &lt;!--åˆ‡æ¢åˆ°ROOTç›®å½•--&gt;
                    &lt;workdir&gt;/ROOT&lt;/workdir&gt;
                    &lt;cmd&gt;[&quot;java&quot;, &quot;-version&quot;]&lt;/cmd&gt;
                    &lt;entryPoint&gt;[&quot;java&quot;, &quot;-jar&quot;, &quot;/${project.build.finalName}.jar&quot;]&lt;/entryPoint&gt;
                    &lt;!--æŒ‡å®šè¿œç¨‹ docker apiåœ°å€--&gt;
                    &lt;dockerHost&gt;http://122.51.50.249:2375&lt;/dockerHost&gt;
                    &lt;!-- è¿™é‡Œæ˜¯å¤åˆ¶ jar åŒ…åˆ° docker å®¹å™¨æŒ‡å®šç›®å½•é…ç½® --&gt;
                    &lt;resources&gt;
                        &lt;resource&gt;
                            &lt;targetPath&gt;/&lt;/targetPath&gt;
                            &lt;!--jar åŒ…æ‰€åœ¨çš„è·¯å¾„  æ­¤å¤„é…ç½®çš„ å³å¯¹åº” target ç›®å½•--&gt;
                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
                            &lt;!--ç”¨äºæŒ‡å®šéœ€è¦å¤åˆ¶çš„æ–‡ä»¶ éœ€è¦åŒ…å«çš„ jaråŒ… ï¼Œè¿™é‡Œå¯¹åº”çš„æ˜¯ Dockerfileä¸­æ·»åŠ çš„æ–‡ä»¶å --&gt;
                            &lt;include&gt;${project.build.finalName}.jar&lt;/include&gt;
                        &lt;/resource&gt;
                    &lt;/resources&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;

        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre>
]]></content>
    </entry>
</feed>